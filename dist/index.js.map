{"version":3,"file":"index.js","sources":["../src/composables/useImageViewer.ts","../src/components/ImageViewer.vue","../src/components/ImageViewerProvider.vue","../src/composables/useAvatarUpload.ts","../src/composables/useAvatarCropper.ts","../src/components/AvatarCropper.vue","../src/components/AvatarUpload.vue","../src/composables/useAvatarManager.ts","../src/components/AvatarManager.vue"],"sourcesContent":["/**\n * useImageViewer - Composable for opening the image viewer from anywhere\n * \n * Usage:\n *   import { useImageViewer } from 'nonspace-ui'\n *   \n *   const { openViewer } = useImageViewer()\n *   \n *   // Single image\n *   openViewer([{ url: 'https://...' }])\n *   \n *   // Gallery with starting index\n *   openViewer([\n *     { url: 'img1.jpg', thumbnail: 'img1_thumb.jpg' },\n *     { url: 'img2.jpg', thumbnail: 'img2_thumb.jpg' },\n *   ], 1) // Start at second image\n */\n\nimport { ref, readonly, type Ref, type DeepReadonly } from 'vue'\n\n/** A single variant with URL and dimensions */\nexport interface ImageVariant {\n  url: string\n  width: number\n  height: number\n}\n\n/** Available image variants for quality selection */\nexport interface ImageVariants {\n  thumb?: ImageVariant\n  sm?: ImageVariant\n  md?: ImageVariant\n  lg?: ImageVariant\n  original?: ImageVariant\n}\n\n/** An image that can be displayed in the viewer */\nexport interface ViewerImage {\n  /** Primary URL to display */\n  url: string\n  /** Thumbnail URL for gallery strip */\n  thumbnail?: string\n  /** Alt text for accessibility */\n  alt?: string\n  /** Original dimensions */\n  width?: number\n  height?: number\n  /** Optional file ID for custom variant fetching */\n  fileId?: string\n  /** Pre-loaded variants for quality selection */\n  variants?: ImageVariants\n}\n\n/**\n * Function signature for fetching image variants\n * Allows consuming projects to plug in their own API\n */\nexport type FetchVariantsFn = (fileId: string) => Promise<ImageVariants | null>\n\n// Global state - shared across all components\nconst isOpen = ref(false)\nconst images = ref<ViewerImage[]>([])\nconst initialIndex = ref(0)\n\n// Optional variant fetcher that can be set by consuming app\nlet variantFetcher: FetchVariantsFn | null = null\n\nexport function useImageViewer() {\n  /**\n   * Set a custom function for fetching image variants\n   * Call this once at app initialization\n   */\n  function setVariantFetcher(fn: FetchVariantsFn | null) {\n    variantFetcher = fn\n  }\n\n  /**\n   * Get the current variant fetcher (if set)\n   */\n  function getVariantFetcher(): FetchVariantsFn | null {\n    return variantFetcher\n  }\n\n  /**\n   * Open the image viewer\n   */\n  function openViewer(newImages: ViewerImage[], startIndex = 0) {\n    images.value = newImages\n    initialIndex.value = startIndex\n    isOpen.value = true\n  }\n\n  /**\n   * Close the image viewer\n   */\n  function closeViewer() {\n    isOpen.value = false\n  }\n\n  /**\n   * Open a single image\n   */\n  function openImage(url: string, alt?: string) {\n    openViewer([{ url, alt }], 0)\n  }\n\n  return {\n    // State (readonly to prevent external mutation)\n    isOpen: readonly(isOpen) as DeepReadonly<Ref<boolean>>,\n    images: readonly(images) as DeepReadonly<Ref<ViewerImage[]>>,\n    initialIndex: readonly(initialIndex) as DeepReadonly<Ref<number>>,\n    \n    // Actions\n    openViewer,\n    closeViewer,\n    openImage,\n    setVariantFetcher,\n    getVariantFetcher,\n    \n    // For the provider component\n    _setOpen: (value: boolean) => { isOpen.value = value },\n  }\n}\n\n\n\n","<script setup lang=\"ts\">\n/**\n * ImageViewer - A standalone, reusable image lightbox component\n * \n * Features:\n * - Fullscreen lightbox overlay\n * - Zoom in/out with mouse wheel or buttons\n * - Pan when zoomed (drag to move)\n * - Keyboard navigation (Escape, arrow keys, +/-)\n * - Touch/pinch zoom support\n * - Gallery mode with multiple images\n * - Smooth animations\n * - Download button\n * - Optional variant fetching for higher quality images\n * \n * Usage:\n *   <ImageViewer \n *     :images=\"[{ url: '...', thumbnail: '...', alt: '...' }]\"\n *     :initial-index=\"0\"\n *     :open=\"isOpen\"\n *     @close=\"isOpen = false\"\n *   />\n * \n * Or use the composable:\n *   const { openViewer } = useImageViewer()\n *   openViewer([{ url: '...' }], 0)\n */\n\nimport { ref, computed, watch, onMounted, onUnmounted } from 'vue'\nimport type { ViewerImage, ImageVariants } from '../composables/useImageViewer'\nimport { useImageViewer } from '../composables/useImageViewer'\n\nconst props = withDefaults(defineProps<{\n  images: ViewerImage[]\n  initialIndex?: number\n  open: boolean\n}>(), {\n  initialIndex: 0,\n})\n\nconst emit = defineEmits<{\n  close: []\n  indexChange: [index: number]\n}>()\n\nconst { getVariantFetcher } = useImageViewer()\n\n// State\nconst currentIndex = ref(props.initialIndex)\nconst zoom = ref(1)\nconst panX = ref(0)\nconst panY = ref(0)\nconst isDragging = ref(false)\nconst dragStart = ref({ x: 0, y: 0 })\nconst isLoading = ref(true)\nconst hasError = ref(false)\nconst isLoadingVariants = ref(false)\nconst loadedVariants = ref<Map<string, ImageVariants>>(new Map())\n\n// Current image from props\nconst currentImageRaw = computed(() => props.images[currentIndex.value])\n\n// Current image with potentially enhanced variants\nconst currentImage = computed(() => {\n  const raw = currentImageRaw.value\n  if (!raw) return null\n  \n  // Check if we have loaded variants for this image\n  if (raw.fileId && loadedVariants.value.has(raw.fileId)) {\n    const variants = loadedVariants.value.get(raw.fileId)!\n    return { ...raw, variants }\n  }\n  \n  return raw\n})\n\n// Get the best available URL for the current image\nconst currentImageUrl = computed(() => {\n  const img = currentImage.value\n  if (!img) return ''\n  \n  // Prefer higher quality variants: lg > md > sm > original > url\n  if (img.variants) {\n    if (img.variants.lg?.url) return img.variants.lg.url\n    if (img.variants.original?.url) return img.variants.original.url\n    if (img.variants.md?.url) return img.variants.md.url\n    if (img.variants.sm?.url) return img.variants.sm.url\n    if (img.variants.thumb?.url) return img.variants.thumb.url\n  }\n  \n  return img.url\n})\n\nconst hasMultiple = computed(() => props.images.length > 1)\nconst canPrev = computed(() => currentIndex.value > 0)\nconst canNext = computed(() => currentIndex.value < props.images.length - 1)\n\n// Reset state when image changes\nwatch(currentIndex, () => {\n  zoom.value = 1\n  panX.value = 0\n  panY.value = 0\n  isLoading.value = true\n  hasError.value = false\n  emit('indexChange', currentIndex.value)\n})\n\n// Reset when opening\nwatch(() => props.open, (isOpen) => {\n  if (isOpen) {\n    currentIndex.value = props.initialIndex\n    zoom.value = 1\n    panX.value = 0\n    panY.value = 0\n    isLoading.value = true\n    hasError.value = false\n    document.body.style.overflow = 'hidden'\n    \n    // Try to fetch variants for the initial image\n    fetchVariantsIfNeeded()\n  } else {\n    document.body.style.overflow = ''\n  }\n})\n\n// Fetch variants when image changes\nwatch(currentImageRaw, () => {\n  fetchVariantsIfNeeded()\n})\n\n// Fetch full-resolution variants if a fetcher is configured\nasync function fetchVariantsIfNeeded() {\n  const img = currentImageRaw.value\n  if (!img?.fileId) return\n  \n  // Already have variants\n  if (loadedVariants.value.has(img.fileId)) return\n  \n  // Check if we already have good variants\n  if (img.variants?.lg || img.variants?.original) return\n  \n  // Check if a variant fetcher is configured\n  const fetcher = getVariantFetcher()\n  if (!fetcher) return\n  \n  isLoadingVariants.value = true\n  \n  try {\n    const variants = await fetcher(img.fileId)\n    if (variants) {\n      loadedVariants.value.set(img.fileId, variants)\n    }\n  } catch (err) {\n    console.error('Failed to fetch variants:', err)\n  } finally {\n    isLoadingVariants.value = false\n  }\n}\n\n// Navigation\nfunction prev() {\n  if (canPrev.value) {\n    currentIndex.value--\n  }\n}\n\nfunction next() {\n  if (canNext.value) {\n    currentIndex.value++\n  }\n}\n\nfunction goTo(index: number) {\n  if (index >= 0 && index < props.images.length) {\n    currentIndex.value = index\n  }\n}\n\n// Zoom controls\nconst MIN_ZOOM = 0.5\nconst MAX_ZOOM = 5\nconst ZOOM_STEP = 0.25\n\nfunction zoomIn() {\n  zoom.value = Math.min(MAX_ZOOM, zoom.value + ZOOM_STEP)\n}\n\nfunction zoomOut() {\n  zoom.value = Math.max(MIN_ZOOM, zoom.value - ZOOM_STEP)\n  if (zoom.value <= 1) {\n    panX.value = 0\n    panY.value = 0\n  }\n}\n\nfunction resetZoom() {\n  zoom.value = 1\n  panX.value = 0\n  panY.value = 0\n}\n\nfunction handleWheel(e: WheelEvent) {\n  e.preventDefault()\n  if (e.deltaY < 0) {\n    zoomIn()\n  } else {\n    zoomOut()\n  }\n}\n\n// Pan (drag when zoomed)\nfunction startDrag(e: MouseEvent | TouchEvent) {\n  if (zoom.value <= 1) return\n  isDragging.value = true\n  const point = 'touches' in e ? e.touches[0] : e\n  dragStart.value = { x: point.clientX - panX.value, y: point.clientY - panY.value }\n}\n\nfunction doDrag(e: MouseEvent | TouchEvent) {\n  if (!isDragging.value) return\n  e.preventDefault()\n  const point = 'touches' in e ? e.touches[0] : e\n  panX.value = point.clientX - dragStart.value.x\n  panY.value = point.clientY - dragStart.value.y\n}\n\nfunction endDrag() {\n  isDragging.value = false\n}\n\n// Keyboard handling\nfunction handleKeydown(e: KeyboardEvent) {\n  if (!props.open) return\n  \n  switch (e.key) {\n    case 'Escape':\n      emit('close')\n      break\n    case 'ArrowLeft':\n      prev()\n      break\n    case 'ArrowRight':\n      next()\n      break\n    case '+':\n    case '=':\n      zoomIn()\n      break\n    case '-':\n      zoomOut()\n      break\n    case '0':\n      resetZoom()\n      break\n  }\n}\n\n// Download current image (prefer full-res)\nasync function downloadImage() {\n  if (!currentImage.value) return\n  \n  try {\n    // Use best available URL for download\n    const downloadUrl = currentImageUrl.value\n    const response = await fetch(downloadUrl)\n    const blob = await response.blob()\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = currentImage.value.alt || `image-${currentIndex.value + 1}`\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n    URL.revokeObjectURL(url)\n  } catch (err) {\n    console.error('Failed to download image:', err)\n  }\n}\n\n// Image load handlers\nfunction onImageLoad() {\n  isLoading.value = false\n}\n\nfunction onImageError() {\n  isLoading.value = false\n  hasError.value = true\n}\n\n// Close on backdrop click (but not on image)\nfunction handleBackdropClick(e: MouseEvent) {\n  if ((e.target as HTMLElement).classList.contains('viewer-backdrop')) {\n    emit('close')\n  }\n}\n\n// Lifecycle\nonMounted(() => {\n  window.addEventListener('keydown', handleKeydown)\n})\n\nonUnmounted(() => {\n  window.removeEventListener('keydown', handleKeydown)\n  document.body.style.overflow = ''\n})\n\n// Image transform style\nconst imageStyle = computed(() => ({\n  transform: `scale(${zoom.value}) translate(${panX.value / zoom.value}px, ${panY.value / zoom.value}px)`,\n  cursor: zoom.value > 1 ? (isDragging.value ? 'grabbing' : 'grab') : 'default',\n}))\n</script>\n\n<template>\n  <Teleport to=\"body\">\n    <Transition name=\"viewer\">\n      <div \n        v-if=\"open\" \n        class=\"viewer-backdrop\"\n        @click=\"handleBackdropClick\"\n        @wheel.prevent=\"handleWheel\"\n      >\n        <!-- Close button -->\n        <button class=\"viewer-btn close-btn\" @click=\"emit('close')\" title=\"Close (Esc)\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M18 6L6 18M6 6l12 12\"/>\n          </svg>\n        </button>\n\n        <!-- Top toolbar -->\n        <div class=\"viewer-toolbar top\">\n          <span class=\"image-counter\" v-if=\"hasMultiple\">\n            {{ currentIndex + 1 }} / {{ images.length }}\n          </span>\n        </div>\n\n        <!-- Navigation arrows -->\n        <button \n          v-if=\"hasMultiple && canPrev\" \n          class=\"viewer-btn nav-btn prev\"\n          @click.stop=\"prev\"\n          title=\"Previous (←)\"\n        >\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M15 18l-6-6 6-6\"/>\n          </svg>\n        </button>\n\n        <button \n          v-if=\"hasMultiple && canNext\" \n          class=\"viewer-btn nav-btn next\"\n          @click.stop=\"next\"\n          title=\"Next (→)\"\n        >\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M9 18l6-6-6-6\"/>\n          </svg>\n        </button>\n\n        <!-- Main image container -->\n        <div class=\"image-container\">\n          <!-- Loading spinner -->\n          <div v-if=\"isLoading\" class=\"loading-spinner\">\n            <div class=\"spinner\"></div>\n          </div>\n\n          <!-- Error state -->\n          <div v-if=\"hasError\" class=\"error-state\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n              <path d=\"M12 8v4M12 16h.01\"/>\n            </svg>\n            <span>Failed to load image</span>\n          </div>\n\n          <!-- Image -->\n          <img\n            v-show=\"!hasError\"\n            :src=\"currentImageUrl\"\n            :alt=\"currentImage?.alt || 'Image'\"\n            :style=\"imageStyle\"\n            class=\"viewer-image\"\n            draggable=\"false\"\n            @load=\"onImageLoad\"\n            @error=\"onImageError\"\n            @mousedown=\"startDrag\"\n            @mousemove=\"doDrag\"\n            @mouseup=\"endDrag\"\n            @mouseleave=\"endDrag\"\n            @touchstart=\"startDrag\"\n            @touchmove=\"doDrag\"\n            @touchend=\"endDrag\"\n          />\n          \n          <!-- Loading variants indicator -->\n          <div v-if=\"isLoadingVariants\" class=\"loading-variants\">\n            Loading full resolution...\n          </div>\n        </div>\n\n        <!-- Bottom toolbar -->\n        <div class=\"viewer-toolbar bottom\">\n          <!-- Zoom controls -->\n          <div class=\"zoom-controls\">\n            <button class=\"viewer-btn small\" @click=\"zoomOut\" title=\"Zoom out (-)\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n                <path d=\"M21 21l-4.35-4.35M8 11h6\"/>\n              </svg>\n            </button>\n            <span class=\"zoom-level\" @click=\"resetZoom\" title=\"Reset zoom (0)\">\n              {{ Math.round(zoom * 100) }}%\n            </span>\n            <button class=\"viewer-btn small\" @click=\"zoomIn\" title=\"Zoom in (+)\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n                <path d=\"M21 21l-4.35-4.35M11 8v6M8 11h6\"/>\n              </svg>\n            </button>\n          </div>\n\n          <!-- Download button -->\n          <button class=\"viewer-btn small\" @click=\"downloadImage\" title=\"Download\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\"/>\n            </svg>\n          </button>\n        </div>\n\n        <!-- Thumbnail strip for gallery -->\n        <div v-if=\"hasMultiple && images.length <= 20\" class=\"thumbnail-strip\">\n          <button\n            v-for=\"(img, idx) in images\"\n            :key=\"idx\"\n            class=\"thumbnail\"\n            :class=\"{ active: idx === currentIndex }\"\n            @click=\"goTo(idx)\"\n          >\n            <img :src=\"img.thumbnail || img.url\" :alt=\"`Thumbnail ${idx + 1}`\" />\n          </button>\n        </div>\n      </div>\n    </Transition>\n  </Teleport>\n</template>\n\n<style scoped>\n.viewer-backdrop {\n  position: fixed;\n  inset: 0;\n  z-index: 9999;\n  background: rgba(0, 0, 0, 0.95);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  backdrop-filter: blur(8px);\n}\n\n/* Transitions */\n.viewer-enter-active,\n.viewer-leave-active {\n  transition: opacity 0.2s ease;\n}\n\n.viewer-enter-from,\n.viewer-leave-to {\n  opacity: 0;\n}\n\n/* Buttons */\n.viewer-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.1);\n  border: none;\n  border-radius: 8px;\n  color: white;\n  cursor: pointer;\n  transition: all 0.15s;\n}\n\n.viewer-btn:hover {\n  background: rgba(255, 255, 255, 0.2);\n  transform: scale(1.05);\n}\n\n.viewer-btn:active {\n  transform: scale(0.95);\n}\n\n.viewer-btn svg {\n  width: 24px;\n  height: 24px;\n}\n\n.viewer-btn.small {\n  width: 40px;\n  height: 40px;\n}\n\n.viewer-btn.small svg {\n  width: 20px;\n  height: 20px;\n}\n\n/* Close button */\n.close-btn {\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  width: 48px;\n  height: 48px;\n  z-index: 10;\n}\n\n/* Navigation buttons */\n.nav-btn {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 56px;\n  height: 56px;\n  z-index: 10;\n}\n\n.nav-btn.prev {\n  left: 16px;\n}\n\n.nav-btn.next {\n  right: 16px;\n}\n\n/* Toolbars */\n.viewer-toolbar {\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  padding: 8px 16px;\n  background: rgba(0, 0, 0, 0.6);\n  border-radius: 12px;\n  z-index: 10;\n}\n\n.viewer-toolbar.top {\n  top: 16px;\n}\n\n.viewer-toolbar.bottom {\n  bottom: 16px;\n}\n\n.image-counter {\n  color: white;\n  font-size: 14px;\n  font-weight: 500;\n  font-variant-numeric: tabular-nums;\n}\n\n/* Zoom controls */\n.zoom-controls {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.zoom-level {\n  color: white;\n  font-size: 13px;\n  font-weight: 500;\n  min-width: 50px;\n  text-align: center;\n  cursor: pointer;\n  padding: 4px 8px;\n  border-radius: 4px;\n  transition: background 0.15s;\n}\n\n.zoom-level:hover {\n  background: rgba(255, 255, 255, 0.1);\n}\n\n/* Image container */\n.image-container {\n  position: relative;\n  max-width: 90vw;\n  max-height: 80vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.viewer-image {\n  max-width: 90vw;\n  max-height: 80vh;\n  object-fit: contain;\n  user-select: none;\n  transition: transform 0.1s ease-out;\n}\n\n/* Loading spinner */\n.loading-spinner {\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.spinner {\n  width: 48px;\n  height: 48px;\n  border: 3px solid rgba(255, 255, 255, 0.2);\n  border-top-color: white;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n/* Error state */\n.error-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n  color: rgba(255, 255, 255, 0.6);\n}\n\n.error-state svg {\n  width: 48px;\n  height: 48px;\n}\n\n/* Loading variants indicator */\n.loading-variants {\n  position: absolute;\n  bottom: 16px;\n  left: 50%;\n  transform: translateX(-50%);\n  background: rgba(0, 0, 0, 0.7);\n  color: rgba(255, 255, 255, 0.8);\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n}\n\n/* Thumbnail strip */\n.thumbnail-strip {\n  position: absolute;\n  bottom: 80px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 8px;\n  padding: 8px;\n  background: rgba(0, 0, 0, 0.6);\n  border-radius: 12px;\n  max-width: 90vw;\n  overflow-x: auto;\n}\n\n.thumbnail {\n  flex-shrink: 0;\n  width: 60px;\n  height: 60px;\n  border: 2px solid transparent;\n  border-radius: 8px;\n  overflow: hidden;\n  cursor: pointer;\n  opacity: 0.6;\n  transition: all 0.15s;\n  padding: 0;\n  background: none;\n}\n\n.thumbnail:hover {\n  opacity: 0.9;\n}\n\n.thumbnail.active {\n  border-color: white;\n  opacity: 1;\n}\n\n.thumbnail img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n/* Mobile adjustments */\n@media (max-width: 768px) {\n  .nav-btn {\n    width: 44px;\n    height: 44px;\n  }\n  \n  .nav-btn.prev {\n    left: 8px;\n  }\n  \n  .nav-btn.next {\n    right: 8px;\n  }\n  \n  .close-btn {\n    top: 8px;\n    right: 8px;\n    width: 44px;\n    height: 44px;\n  }\n  \n  .thumbnail-strip {\n    bottom: 70px;\n  }\n  \n  .thumbnail {\n    width: 48px;\n    height: 48px;\n  }\n}\n</style>\n\n\n\n","<script setup lang=\"ts\">\n/**\n * ImageViewerProvider - Mount this once at app root to enable global image viewing\n * \n * Usage in App.vue:\n *   import { ImageViewerProvider } from 'nonspace-ui'\n * \n *   <template>\n *     <RouterView />\n *     <ImageViewerProvider />\n *   </template>\n */\n\nimport { computed } from 'vue'\nimport ImageViewer from './ImageViewer.vue'\nimport { useImageViewer, type ViewerImage } from '../composables/useImageViewer'\n\nconst { isOpen, images, initialIndex, _setOpen } = useImageViewer()\n\n// Unwrap readonly for internal component usage\nconst imagesList = computed(() => [...images.value] as ViewerImage[])\n\nfunction handleClose() {\n  _setOpen(false)\n}\n</script>\n\n<template>\n  <ImageViewer\n    :images=\"imagesList\"\n    :initial-index=\"initialIndex\"\n    :open=\"isOpen\"\n    @close=\"handleClose\"\n  />\n</template>\n\n","import { ref, computed, type Ref } from 'vue'\nimport type { AvatarCrop } from './useAvatarManager'\n\nexport interface AvatarUploadConfig {\n  /** API endpoint for uploading (e.g., '/api/v1/upload') */\n  uploadUrl: string\n  /** API key or auth token for authentication */\n  apiKey?: string\n  /** Custom headers to include in upload request */\n  headers?: Record<string, string>\n  /** Project ID to upload to */\n  projectId?: string\n  /** Processing profile to use (default: 'avatar') */\n  profile?: string\n  /** Max file size in bytes (default: 10MB) */\n  maxFileSize?: number\n  /** Accepted file types (default: image/jpeg, image/png, image/webp, image/heic) */\n  acceptedTypes?: string[]\n}\n\nexport interface AvatarUploadResult {\n  id: string\n  url: string\n  variants: Record<string, { url: string; w: number; h: number }>\n}\n\nexport interface AvatarUploadError {\n  message: string\n  code?: string\n}\n\n// Global configuration\nconst globalConfig = ref<Partial<AvatarUploadConfig>>({})\n\n/**\n * Configure avatar upload globally\n * Call this once at app initialization\n */\nexport function configureAvatarUpload(config: Partial<AvatarUploadConfig>) {\n  globalConfig.value = { ...globalConfig.value, ...config }\n}\n\n/**\n * Composable for avatar upload functionality\n */\nexport function useAvatarUpload(localConfig?: Partial<AvatarUploadConfig>) {\n  const uploading = ref(false)\n  const progress = ref(0)\n  const error = ref<AvatarUploadError | null>(null)\n  const previewUrl = ref<string | null>(null)\n  const selectedFile = ref<File | null>(null)\n  \n  // Merge global and local config\n  const config = computed<AvatarUploadConfig>(() => ({\n    uploadUrl: '/api/v1/upload',\n    profile: 'avatar',\n    maxFileSize: 10 * 1024 * 1024, // 10MB\n    acceptedTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/heic', 'image/heif'],\n    ...globalConfig.value,\n    ...localConfig,\n  }))\n\n  /**\n   * Validate a file before upload\n   */\n  function validateFile(file: File): AvatarUploadError | null {\n    if (!config.value.acceptedTypes?.some(type => file.type === type || file.type.startsWith(type.replace('/*', '/')))) {\n      return { \n        message: 'Invalid file type. Please select a JPEG, PNG, WebP, or HEIC image.',\n        code: 'INVALID_TYPE'\n      }\n    }\n    \n    if (config.value.maxFileSize && file.size > config.value.maxFileSize) {\n      const maxMB = Math.round(config.value.maxFileSize / (1024 * 1024))\n      return {\n        message: `File too large. Maximum size is ${maxMB}MB.`,\n        code: 'FILE_TOO_LARGE'\n      }\n    }\n    \n    return null\n  }\n\n  /**\n   * Select a file and create preview\n   */\n  function selectFile(file: File): AvatarUploadError | null {\n    const validationError = validateFile(file)\n    if (validationError) {\n      error.value = validationError\n      return validationError\n    }\n    \n    // Revoke previous preview URL to avoid memory leak\n    if (previewUrl.value) {\n      URL.revokeObjectURL(previewUrl.value)\n    }\n    \n    selectedFile.value = file\n    previewUrl.value = URL.createObjectURL(file)\n    error.value = null\n    \n    return null\n  }\n\n  /**\n   * Clear the current selection\n   */\n  function clearSelection() {\n    if (previewUrl.value) {\n      URL.revokeObjectURL(previewUrl.value)\n    }\n    selectedFile.value = null\n    previewUrl.value = null\n    error.value = null\n    progress.value = 0\n  }\n\n  /**\n   * Upload the selected file\n   */\n  async function upload(): Promise<AvatarUploadResult | null> {\n    if (!selectedFile.value) {\n      error.value = { message: 'No file selected', code: 'NO_FILE' }\n      return null\n    }\n    \n    uploading.value = true\n    progress.value = 0\n    error.value = null\n    \n    try {\n      const formData = new FormData()\n      formData.append('file', selectedFile.value)\n      formData.append('profile', config.value.profile || 'avatar')\n      \n      if (config.value.projectId) {\n        formData.append('project_id', config.value.projectId)\n      }\n      \n      // Build headers\n      const headers: Record<string, string> = {}\n      \n      if (config.value.apiKey) {\n        headers['Authorization'] = `Bearer ${config.value.apiKey}`\n      }\n      \n      if (config.value.headers) {\n        Object.assign(headers, config.value.headers)\n      }\n      \n      // Use XMLHttpRequest for progress tracking\n      const result = await new Promise<AvatarUploadResult>((resolve, reject) => {\n        const xhr = new XMLHttpRequest()\n        \n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            progress.value = Math.round((e.loaded / e.total) * 100)\n          }\n        })\n        \n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const response = JSON.parse(xhr.responseText)\n              // Handle API response format (may have data wrapper)\n              const data = response.data || response\n              resolve({\n                id: data.id,\n                url: data.url || data.signed_url,\n                variants: data.variants || {}\n              })\n            } catch {\n              reject({ message: 'Invalid response from server', code: 'PARSE_ERROR' })\n            }\n          } else {\n            let errorMessage = 'Upload failed'\n            try {\n              const response = JSON.parse(xhr.responseText)\n              errorMessage = response.error || response.message || errorMessage\n            } catch {}\n            reject({ message: errorMessage, code: `HTTP_${xhr.status}` })\n          }\n        })\n        \n        xhr.addEventListener('error', () => {\n          reject({ message: 'Network error during upload', code: 'NETWORK_ERROR' })\n        })\n        \n        xhr.addEventListener('abort', () => {\n          reject({ message: 'Upload cancelled', code: 'ABORTED' })\n        })\n        \n        xhr.open('POST', config.value.uploadUrl)\n        \n        for (const [key, value] of Object.entries(headers)) {\n          xhr.setRequestHeader(key, value)\n        }\n        \n        xhr.send(formData)\n      })\n      \n      progress.value = 100\n      return result\n      \n    } catch (e: any) {\n      error.value = e as AvatarUploadError\n      return null\n    } finally {\n      uploading.value = false\n    }\n  }\n\n  /**\n   * Select and immediately upload a file\n   */\n  async function selectAndUpload(file: File): Promise<AvatarUploadResult | null> {\n    const validationError = selectFile(file)\n    if (validationError) {\n      return null\n    }\n    return upload()\n  }\n\n  /**\n   * Upload the selected file with crop metadata\n   * The crop data is sent to the server so it can be stored/applied server-side\n   */\n  async function uploadWithCrop(crop: AvatarCrop): Promise<AvatarUploadResult | null> {\n    if (!selectedFile.value) {\n      error.value = { message: 'No file selected', code: 'NO_FILE' }\n      return null\n    }\n    \n    uploading.value = true\n    progress.value = 0\n    error.value = null\n    \n    try {\n      const formData = new FormData()\n      formData.append('file', selectedFile.value)\n      formData.append('profile', config.value.profile || 'avatar')\n      \n      // Include crop metadata\n      formData.append('crop_x', String(crop.x))\n      formData.append('crop_y', String(crop.y))\n      formData.append('crop_width', String(crop.width))\n      formData.append('crop_height', String(crop.height))\n      if (crop.zoom !== undefined) {\n        formData.append('crop_zoom', String(crop.zoom))\n      }\n      \n      if (config.value.projectId) {\n        formData.append('project_id', config.value.projectId)\n      }\n      \n      // Build headers\n      const headers: Record<string, string> = {}\n      \n      if (config.value.apiKey) {\n        headers['Authorization'] = `Bearer ${config.value.apiKey}`\n      }\n      \n      if (config.value.headers) {\n        Object.assign(headers, config.value.headers)\n      }\n      \n      // Use XMLHttpRequest for progress tracking\n      const result = await new Promise<AvatarUploadResult>((resolve, reject) => {\n        const xhr = new XMLHttpRequest()\n        \n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            progress.value = Math.round((e.loaded / e.total) * 100)\n          }\n        })\n        \n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const response = JSON.parse(xhr.responseText)\n              // Handle API response format (may have data wrapper)\n              const data = response.data || response\n              resolve({\n                id: data.id,\n                url: data.url || data.signed_url,\n                variants: data.variants || {}\n              })\n            } catch {\n              reject({ message: 'Invalid response from server', code: 'PARSE_ERROR' })\n            }\n          } else {\n            let errorMessage = 'Upload failed'\n            try {\n              const response = JSON.parse(xhr.responseText)\n              errorMessage = response.error || response.message || errorMessage\n            } catch {}\n            reject({ message: errorMessage, code: `HTTP_${xhr.status}` })\n          }\n        })\n        \n        xhr.addEventListener('error', () => {\n          reject({ message: 'Network error during upload', code: 'NETWORK_ERROR' })\n        })\n        \n        xhr.addEventListener('abort', () => {\n          reject({ message: 'Upload cancelled', code: 'ABORTED' })\n        })\n        \n        xhr.open('POST', config.value.uploadUrl)\n        \n        for (const [key, value] of Object.entries(headers)) {\n          xhr.setRequestHeader(key, value)\n        }\n        \n        xhr.send(formData)\n      })\n      \n      progress.value = 100\n      return result\n      \n    } catch (e: any) {\n      error.value = e as AvatarUploadError\n      return null\n    } finally {\n      uploading.value = false\n    }\n  }\n\n  return {\n    // State\n    uploading,\n    progress,\n    error,\n    previewUrl,\n    selectedFile,\n    config,\n    \n    // Methods\n    validateFile,\n    selectFile,\n    clearSelection,\n    upload,\n    selectAndUpload,\n    uploadWithCrop,\n  }\n}\n\nexport type { Ref }\n\n\n\n","import { ref, computed, watch, type Ref } from 'vue'\nimport type { AvatarCrop } from './useAvatarManager'\n\nexport interface CropperState {\n  /** Image element being cropped */\n  image: HTMLImageElement | null\n  /** Natural width of the source image */\n  naturalWidth: number\n  /** Natural height of the source image */\n  naturalHeight: number\n  /** Current pan offset X (in image pixels) */\n  panX: number\n  /** Current pan offset Y (in image pixels) */\n  panY: number\n  /** Current zoom level (1 = fit, higher = zoomed in) */\n  zoom: number\n  /** Minimum zoom to fill the crop area */\n  minZoom: number\n  /** Maximum zoom level */\n  maxZoom: number\n}\n\nexport interface CropperConfig {\n  /** Shape of the crop area */\n  shape?: 'circle' | 'square' | 'rounded'\n  /** Size of the crop preview area in pixels */\n  cropSize?: number\n  /** Output size for the cropped image */\n  outputSize?: number\n  /** Maximum zoom multiplier */\n  maxZoom?: number\n  /** Output format */\n  format?: 'image/jpeg' | 'image/png' | 'image/webp'\n  /** Output quality (0-1) for jpeg/webp */\n  quality?: number\n  /** Media proxy URL for loading external images (to bypass CORS) */\n  mediaProxyUrl?: string\n}\n\n// Required config with defaults (mediaProxyUrl is optional)\ntype RequiredCropperConfig = Required<Omit<CropperConfig, 'mediaProxyUrl'>> & Pick<CropperConfig, 'mediaProxyUrl'>\n\nconst defaultConfig: RequiredCropperConfig = {\n  shape: 'circle',\n  cropSize: 280,\n  outputSize: 512,\n  maxZoom: 5,\n  format: 'image/jpeg',\n  quality: 0.92,\n  mediaProxyUrl: undefined,\n}\n\n/**\n * Composable for handling avatar image cropping\n */\nexport function useAvatarCropper(config?: CropperConfig) {\n  const mergedConfig = computed<RequiredCropperConfig>(() => ({ ...defaultConfig, ...config }))\n  \n  const state = ref<CropperState>({\n    image: null,\n    naturalWidth: 0,\n    naturalHeight: 0,\n    panX: 0,\n    panY: 0,\n    zoom: 1,\n    minZoom: 1,\n    maxZoom: defaultConfig.maxZoom,\n  })\n  \n  const loading = ref(false)\n  const error = ref<string | null>(null)\n  const sourceFile = ref<File | null>(null)\n  const sourceUrl = ref<string | null>(null)\n  \n  /**\n   * Initialize state after image is loaded\n   */\n  function initializeImageState(img: HTMLImageElement) {\n    state.value.image = img\n    state.value.naturalWidth = img.naturalWidth\n    state.value.naturalHeight = img.naturalHeight\n    \n    // Calculate minimum zoom so the image fills the entire crop area\n    // We use the LARGER scale factor to ensure no empty space\n    const { cropSize } = mergedConfig.value\n    const scaleX = cropSize / img.naturalWidth\n    const scaleY = cropSize / img.naturalHeight\n    const minZoom = Math.max(scaleX, scaleY)\n    \n    console.log('[Cropper] Image initialized:', {\n      naturalWidth: img.naturalWidth,\n      naturalHeight: img.naturalHeight,\n      cropSize,\n      scaleX: scaleX.toFixed(4),\n      scaleY: scaleY.toFixed(4),\n      minZoom: minZoom.toFixed(4),\n    })\n    \n    state.value.minZoom = minZoom\n    state.value.maxZoom = minZoom * mergedConfig.value.maxZoom\n    state.value.zoom = minZoom\n    \n    // Center the image in the crop area\n    centerImage()\n    \n    console.log('[Cropper] After centering:', {\n      panX: state.value.panX.toFixed(2),\n      panY: state.value.panY.toFixed(2),\n      zoom: state.value.zoom.toFixed(4),\n    })\n  }\n\n  /**\n   * Load an image from a File\n   */\n  async function loadFile(file: File): Promise<boolean> {\n    loading.value = true\n    error.value = null\n    sourceFile.value = file\n    \n    // Revoke previous URL\n    if (sourceUrl.value) {\n      URL.revokeObjectURL(sourceUrl.value)\n    }\n    \n    try {\n      const url = URL.createObjectURL(file)\n      sourceUrl.value = url\n      \n      const img = await loadImage(url)\n      initializeImageState(img)\n      \n      loading.value = false\n      return true\n    } catch (e) {\n      error.value = 'Failed to load image'\n      loading.value = false\n      return false\n    }\n  }\n  \n  /**\n   * Load an image from a URL\n   * If the URL is external and a mediaProxyUrl is configured, uses the proxy\n   */\n  async function loadUrl(url: string): Promise<boolean> {\n    loading.value = true\n    error.value = null\n    sourceFile.value = null\n    \n    try {\n      // Check if this is an external URL that needs proxying\n      let loadUrl = url\n      const { mediaProxyUrl } = mergedConfig.value\n      \n      if (mediaProxyUrl && isExternalUrl(url)) {\n        loadUrl = `${mediaProxyUrl}?url=${encodeURIComponent(url)}`\n        console.log('[Cropper] Using proxy for external URL:', loadUrl)\n      }\n      \n      sourceUrl.value = loadUrl\n      const img = await loadImage(loadUrl)\n      initializeImageState(img)\n      loading.value = false\n      return true\n    } catch (e) {\n      console.error('[Cropper] Failed to load image:', e)\n      error.value = 'Failed to load image'\n      loading.value = false\n      return false\n    }\n  }\n  \n  /**\n   * Check if a URL is external (different origin)\n   */\n  function isExternalUrl(url: string): boolean {\n    try {\n      const parsed = new URL(url)\n      return parsed.origin !== window.location.origin\n    } catch {\n      return false\n    }\n  }\n  \n  /**\n   * Helper to load an image element\n   */\n  function loadImage(src: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n      const img = new Image()\n      img.crossOrigin = 'anonymous'\n      img.onload = () => resolve(img)\n      img.onerror = () => reject(new Error('Failed to load image'))\n      img.src = src\n    })\n  }\n  \n  /**\n   * Center the image in the crop area\n   * \n   * The pan values represent the top-left corner of the visible crop region\n   * in the original image's coordinate space.\n   */\n  function centerImage() {\n    const { cropSize } = mergedConfig.value\n    const { naturalWidth, naturalHeight, zoom } = state.value\n    \n    // The visible area in original image coordinates\n    const visibleWidth = cropSize / zoom\n    const visibleHeight = cropSize / zoom\n    \n    // Center the visible area on the image\n    state.value.panX = (naturalWidth - visibleWidth) / 2\n    state.value.panY = (naturalHeight - visibleHeight) / 2\n  }\n  \n  /**\n   * Set zoom level (clamped to valid range)\n   */\n  function setZoom(newZoom: number) {\n    const { minZoom, maxZoom } = state.value\n    const clampedZoom = Math.max(minZoom, Math.min(maxZoom, newZoom))\n    \n    // Adjust pan to keep center point stable\n    const oldZoom = state.value.zoom\n    const { cropSize } = mergedConfig.value\n    \n    // Calculate center point in image coordinates\n    const centerX = state.value.panX + cropSize / (2 * oldZoom)\n    const centerY = state.value.panY + cropSize / (2 * oldZoom)\n    \n    // Set new zoom\n    state.value.zoom = clampedZoom\n    \n    // Recalculate pan to keep same center\n    state.value.panX = centerX - cropSize / (2 * clampedZoom)\n    state.value.panY = centerY - cropSize / (2 * clampedZoom)\n    \n    // Clamp pan to valid bounds\n    clampPan()\n  }\n  \n  /**\n   * Pan the image by delta pixels (in screen space)\n   */\n  function pan(deltaX: number, deltaY: number) {\n    const { zoom } = state.value\n    \n    // Convert screen delta to image space delta\n    state.value.panX -= deltaX / zoom\n    state.value.panY -= deltaY / zoom\n    \n    clampPan()\n  }\n  \n  /**\n   * Clamp pan to keep image covering the crop area\n   */\n  function clampPan() {\n    const { cropSize } = mergedConfig.value\n    const { naturalWidth, naturalHeight, zoom } = state.value\n    \n    // Visible area in image coordinates\n    const visibleWidth = cropSize / zoom\n    const visibleHeight = cropSize / zoom\n    \n    // Clamp pan so image always covers crop area\n    const maxPanX = naturalWidth - visibleWidth\n    const maxPanY = naturalHeight - visibleHeight\n    \n    state.value.panX = Math.max(0, Math.min(maxPanX, state.value.panX))\n    state.value.panY = Math.max(0, Math.min(maxPanY, state.value.panY))\n  }\n  \n  /**\n   * Get the current crop region in original image coordinates\n   */\n  const cropRegion = computed<AvatarCrop | null>(() => {\n    if (!state.value.image) return null\n    \n    const { cropSize } = mergedConfig.value\n    const { panX, panY, zoom } = state.value\n    \n    // The visible area in image coordinates\n    const width = cropSize / zoom\n    const height = cropSize / zoom\n    \n    return {\n      x: Math.round(panX),\n      y: Math.round(panY),\n      width: Math.round(width),\n      height: Math.round(height),\n      zoom,\n    }\n  })\n  \n  /**\n   * Get CSS transform for displaying the image in the crop preview\n   * \n   * The transform moves the image so that the crop region (starting at panX, panY\n   * in image coordinates) is positioned at the top-left of the viewport, then\n   * scales the image.\n   */\n  const imageTransform = computed(() => {\n    const { zoom, panX, panY } = state.value\n    const translateX = -panX * zoom\n    const translateY = -panY * zoom\n    \n    // Debug: log transform values occasionally\n    if (Math.random() < 0.01) {\n      console.log('[Cropper] Transform:', {\n        panX: panX.toFixed(2),\n        panY: panY.toFixed(2),\n        zoom: zoom.toFixed(4),\n        translateX: translateX.toFixed(2),\n        translateY: translateY.toFixed(2),\n      })\n    }\n    \n    return `translate(${translateX}px, ${translateY}px) scale(${zoom})`\n  })\n  \n  /**\n   * Export the cropped image as a Blob\n   */\n  async function exportCrop(): Promise<Blob | null> {\n    if (!state.value.image || !cropRegion.value) return null\n    \n    const { outputSize, format, quality } = mergedConfig.value\n    const crop = cropRegion.value\n    \n    const canvas = document.createElement('canvas')\n    canvas.width = outputSize\n    canvas.height = outputSize\n    \n    const ctx = canvas.getContext('2d')\n    if (!ctx) return null\n    \n    // For circular crops, we still output a square image\n    // The circle mask is purely visual in the UI\n    \n    ctx.drawImage(\n      state.value.image,\n      crop.x,\n      crop.y,\n      crop.width,\n      crop.height,\n      0,\n      0,\n      outputSize,\n      outputSize\n    )\n    \n    return new Promise((resolve) => {\n      canvas.toBlob(\n        (blob) => resolve(blob),\n        format,\n        quality\n      )\n    })\n  }\n  \n  /**\n   * Export as a File (with proper filename)\n   */\n  async function exportCropAsFile(filename?: string): Promise<File | null> {\n    const blob = await exportCrop()\n    if (!blob) return null\n    \n    const { format } = mergedConfig.value\n    const ext = format.split('/')[1]\n    const name = filename || `avatar-cropped.${ext}`\n    \n    return new File([blob], name, { type: format })\n  }\n  \n  /**\n   * Clean up resources\n   */\n  function cleanup() {\n    if (sourceUrl.value && sourceFile.value) {\n      // Only revoke if we created the URL from a file\n      URL.revokeObjectURL(sourceUrl.value)\n    }\n    state.value = {\n      image: null,\n      naturalWidth: 0,\n      naturalHeight: 0,\n      panX: 0,\n      panY: 0,\n      zoom: 1,\n      minZoom: 1,\n      maxZoom: defaultConfig.maxZoom,\n    }\n    sourceFile.value = null\n    sourceUrl.value = null\n    error.value = null\n  }\n  \n  /**\n   * Reset to initial centered state\n   */\n  function reset() {\n    if (!state.value.image) return\n    \n    const { cropSize } = mergedConfig.value\n    const scaleX = cropSize / state.value.naturalWidth\n    const scaleY = cropSize / state.value.naturalHeight\n    const minZoom = Math.max(scaleX, scaleY)\n    \n    state.value.zoom = minZoom\n    centerImage()\n  }\n  \n  return {\n    // State\n    state,\n    loading,\n    error,\n    sourceFile,\n    sourceUrl,\n    cropRegion,\n    imageTransform,\n    config: mergedConfig,\n    \n    // Methods\n    loadFile,\n    loadUrl,\n    setZoom,\n    pan,\n    centerImage,\n    reset,\n    exportCrop,\n    exportCropAsFile,\n    cleanup,\n  }\n}\n\nexport type { AvatarCrop }\n\n","<script setup lang=\"ts\">\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue'\nimport { useAvatarCropper, type CropperConfig, type AvatarCrop } from '../composables/useAvatarCropper'\n\nconst props = withDefaults(defineProps<{\n  /** File to crop */\n  file?: File | null\n  /** URL to crop (alternative to file) */\n  url?: string | null\n  /** Shape of the crop area */\n  shape?: 'circle' | 'square' | 'rounded'\n  /** Size of the crop preview in pixels */\n  cropSize?: number\n  /** Output size for exported image */\n  outputSize?: number\n  /** Show the zoom slider */\n  showZoomSlider?: boolean\n  /** Show reset button */\n  showReset?: boolean\n  /** Primary action label */\n  confirmLabel?: string\n  /** Cancel action label */\n  cancelLabel?: string\n  /** Additional cropper config */\n  config?: CropperConfig\n}>(), {\n  shape: 'circle',\n  cropSize: 280,\n  outputSize: 512,\n  showZoomSlider: true,\n  showReset: true,\n  confirmLabel: 'Apply',\n  cancelLabel: 'Cancel',\n})\n\nconst emit = defineEmits<{\n  (e: 'confirm', data: { file: File; crop: AvatarCrop }): void\n  (e: 'cancel'): void\n  (e: 'crop-change', crop: AvatarCrop): void\n}>()\n\nconst {\n  state,\n  loading,\n  error,\n  sourceUrl,\n  cropRegion,\n  imageTransform,\n  config: cropperConfig,\n  loadFile,\n  loadUrl,\n  setZoom,\n  pan,\n  reset,\n  exportCropAsFile,\n  cleanup,\n} = useAvatarCropper({\n  shape: props.shape,\n  cropSize: props.cropSize,\n  outputSize: props.outputSize,\n  ...props.config,\n})\n\nconst cropAreaRef = ref<HTMLDivElement | null>(null)\nconst isDragging = ref(false)\nconst lastPointer = ref({ x: 0, y: 0 })\n\n// Watch for file/url changes\nwatch(() => props.file, async (newFile) => {\n  if (newFile) {\n    await loadFile(newFile)\n  }\n}, { immediate: true })\n\nwatch(() => props.url, async (newUrl) => {\n  if (newUrl && !props.file) {\n    await loadUrl(newUrl)\n  }\n}, { immediate: true })\n\n// Emit crop changes\nwatch(cropRegion, (crop) => {\n  if (crop) {\n    emit('crop-change', crop)\n  }\n})\n\n// Zoom percentage for display\nconst zoomPercent = computed(() => {\n  if (!state.value.minZoom) return 100\n  return Math.round((state.value.zoom / state.value.minZoom) * 100)\n})\n\n// Normalized zoom for slider (0-1)\nconst normalizedZoom = computed({\n  get: () => {\n    const { zoom, minZoom, maxZoom } = state.value\n    if (maxZoom === minZoom) return 0\n    return (zoom - minZoom) / (maxZoom - minZoom)\n  },\n  set: (value: number) => {\n    const { minZoom, maxZoom } = state.value\n    const newZoom = minZoom + value * (maxZoom - minZoom)\n    setZoom(newZoom)\n  }\n})\n\n// Shape class for crop overlay\nconst shapeClass = computed(() => {\n  switch (props.shape) {\n    case 'circle': return 'rounded-full'\n    case 'rounded': return 'rounded-3xl'\n    default: return ''\n  }\n})\n\n// Pointer event handlers\nfunction handlePointerDown(e: PointerEvent) {\n  if (loading.value) return\n  \n  isDragging.value = true\n  lastPointer.value = { x: e.clientX, y: e.clientY }\n  \n  const target = e.target as HTMLElement\n  target.setPointerCapture(e.pointerId)\n}\n\nfunction handlePointerMove(e: PointerEvent) {\n  if (!isDragging.value) return\n  \n  const deltaX = e.clientX - lastPointer.value.x\n  const deltaY = e.clientY - lastPointer.value.y\n  \n  pan(deltaX, deltaY)\n  \n  lastPointer.value = { x: e.clientX, y: e.clientY }\n}\n\nfunction handlePointerUp(e: PointerEvent) {\n  isDragging.value = false\n  const target = e.target as HTMLElement\n  target.releasePointerCapture(e.pointerId)\n}\n\n// Wheel zoom\nfunction handleWheel(e: WheelEvent) {\n  e.preventDefault()\n  \n  const delta = e.deltaY > 0 ? -0.1 : 0.1\n  const { zoom, minZoom, maxZoom } = state.value\n  const range = maxZoom - minZoom\n  const newZoom = zoom + delta * range * 0.3\n  \n  setZoom(newZoom)\n}\n\n// Touch zoom (pinch)\nlet lastTouchDistance = 0\n\nfunction handleTouchStart(e: TouchEvent) {\n  if (e.touches.length === 2) {\n    lastTouchDistance = getTouchDistance(e.touches)\n  }\n}\n\nfunction handleTouchMove(e: TouchEvent) {\n  if (e.touches.length === 2) {\n    e.preventDefault()\n    const newDistance = getTouchDistance(e.touches)\n    const scale = newDistance / lastTouchDistance\n    \n    setZoom(state.value.zoom * scale)\n    \n    lastTouchDistance = newDistance\n  }\n}\n\nfunction getTouchDistance(touches: TouchList): number {\n  const dx = touches[0].clientX - touches[1].clientX\n  const dy = touches[0].clientY - touches[1].clientY\n  return Math.sqrt(dx * dx + dy * dy)\n}\n\n// Actions\nasync function handleConfirm() {\n  if (!cropRegion.value) return\n  \n  const file = await exportCropAsFile()\n  if (file) {\n    emit('confirm', { file, crop: cropRegion.value })\n  }\n}\n\nfunction handleCancel() {\n  cleanup()\n  emit('cancel')\n}\n\nfunction handleReset() {\n  reset()\n}\n\n// Keyboard support\nfunction handleKeyDown(e: KeyboardEvent) {\n  if (e.key === 'Escape') {\n    handleCancel()\n  } else if (e.key === 'Enter') {\n    handleConfirm()\n  }\n}\n\nonMounted(() => {\n  document.addEventListener('keydown', handleKeyDown)\n})\n\nonUnmounted(() => {\n  document.removeEventListener('keydown', handleKeyDown)\n  cleanup()\n})\n</script>\n\n<template>\n  <div class=\"avatar-cropper flex flex-col items-center gap-6\">\n    <!-- Crop area -->\n    <div class=\"relative\">\n      <!-- Loading state -->\n      <div\n        v-if=\"loading\"\n        class=\"flex items-center justify-center bg-dark-800\"\n        :class=\"shapeClass\"\n        :style=\"{ width: `${cropSize}px`, height: `${cropSize}px` }\"\n      >\n        <div class=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\"></div>\n      </div>\n\n      <!-- Error state -->\n      <div\n        v-else-if=\"error\"\n        class=\"flex flex-col items-center justify-center gap-2 bg-dark-800 text-red-400\"\n        :class=\"shapeClass\"\n        :style=\"{ width: `${cropSize}px`, height: `${cropSize}px` }\"\n      >\n        <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n        </svg>\n        <span class=\"text-sm\">{{ error }}</span>\n      </div>\n\n      <!-- Cropper viewport -->\n      <div\n        v-else-if=\"state.image\"\n        ref=\"cropAreaRef\"\n        class=\"relative overflow-hidden bg-dark-900 select-none touch-none\"\n        :class=\"shapeClass\"\n        :style=\"{ \n          width: `${cropSize}px`, \n          height: `${cropSize}px`,\n          cursor: isDragging ? 'grabbing' : 'grab'\n        }\"\n        @pointerdown=\"handlePointerDown\"\n        @pointermove=\"handlePointerMove\"\n        @pointerup=\"handlePointerUp\"\n        @pointercancel=\"handlePointerUp\"\n        @wheel=\"handleWheel\"\n        @touchstart=\"handleTouchStart\"\n        @touchmove=\"handleTouchMove\"\n      >\n        <!-- The image -->\n        <img\n          :src=\"sourceUrl || ''\"\n          alt=\"Crop preview\"\n          class=\"pointer-events-none\"\n          :style=\"{ \n            position: 'absolute',\n            top: '0',\n            left: '0',\n            width: `${state.naturalWidth}px`,\n            height: `${state.naturalHeight}px`,\n            maxWidth: 'none',\n            maxHeight: 'none',\n            transformOrigin: '0 0',\n            transform: imageTransform \n          }\"\n          draggable=\"false\"\n        />\n\n        <!-- Subtle grid overlay for positioning guidance -->\n        <div class=\"absolute inset-0 pointer-events-none opacity-0 hover:opacity-100 transition-opacity\">\n          <div class=\"absolute inset-0 border border-white/20\"></div>\n          <div class=\"absolute left-1/3 top-0 bottom-0 w-px bg-white/10\"></div>\n          <div class=\"absolute right-1/3 top-0 bottom-0 w-px bg-white/10\"></div>\n          <div class=\"absolute top-1/3 left-0 right-0 h-px bg-white/10\"></div>\n          <div class=\"absolute bottom-1/3 left-0 right-0 h-px bg-white/10\"></div>\n          <!-- Center crosshair -->\n          <div class=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6\">\n            <div class=\"absolute left-1/2 top-0 bottom-0 w-px bg-white/30 -translate-x-1/2\"></div>\n            <div class=\"absolute top-1/2 left-0 right-0 h-px bg-white/30 -translate-y-1/2\"></div>\n          </div>\n        </div>\n\n        <!-- Drag hint overlay (shows briefly) -->\n        <div\n          v-if=\"!isDragging\"\n          class=\"absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity pointer-events-none\"\n        >\n          <div class=\"flex items-center gap-2 px-3 py-1.5 bg-black/60 rounded-full text-white text-sm\">\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4\" />\n            </svg>\n            Drag to reposition\n          </div>\n        </div>\n      </div>\n\n      <!-- Empty state -->\n      <div\n        v-else\n        class=\"flex items-center justify-center bg-dark-800 text-dark-500\"\n        :class=\"shapeClass\"\n        :style=\"{ width: `${cropSize}px`, height: `${cropSize}px` }\"\n      >\n        <svg class=\"w-12 h-12\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n        </svg>\n      </div>\n\n      <!-- Shape outline (for non-circle shapes, subtle border) -->\n      <div\n        v-if=\"props.shape !== 'circle' && state.image\"\n        class=\"absolute inset-0 pointer-events-none border-2 border-white/20\"\n        :class=\"shapeClass\"\n      ></div>\n    </div>\n\n    <!-- Zoom controls -->\n    <div v-if=\"showZoomSlider && state.image\" class=\"w-full max-w-xs space-y-2\">\n      <div class=\"flex items-center gap-3\">\n        <!-- Zoom out icon -->\n        <button\n          type=\"button\"\n          class=\"p-1.5 text-dark-400 hover:text-white rounded-lg hover:bg-dark-700 transition-colors\"\n          @click=\"setZoom(state.zoom - (state.maxZoom - state.minZoom) * 0.1)\"\n          :disabled=\"state.zoom <= state.minZoom\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7\" />\n          </svg>\n        </button>\n\n        <!-- Zoom slider -->\n        <div class=\"flex-1 relative\">\n          <input\n            type=\"range\"\n            :value=\"normalizedZoom\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.01\"\n            class=\"zoom-slider w-full h-2 bg-dark-700 rounded-full appearance-none cursor-pointer\"\n            @input=\"(e) => normalizedZoom = parseFloat((e.target as HTMLInputElement).value)\"\n          />\n        </div>\n\n        <!-- Zoom in icon -->\n        <button\n          type=\"button\"\n          class=\"p-1.5 text-dark-400 hover:text-white rounded-lg hover:bg-dark-700 transition-colors\"\n          @click=\"setZoom(state.zoom + (state.maxZoom - state.minZoom) * 0.1)\"\n          :disabled=\"state.zoom >= state.maxZoom\"\n        >\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7\" />\n          </svg>\n        </button>\n\n        <!-- Zoom percentage -->\n        <span class=\"w-12 text-right text-sm text-dark-400 tabular-nums\">\n          {{ zoomPercent }}%\n        </span>\n      </div>\n    </div>\n\n    <!-- Actions -->\n    <div class=\"flex items-center gap-3\">\n      <button\n        v-if=\"showReset && state.image\"\n        type=\"button\"\n        class=\"px-4 py-2 text-sm text-dark-400 hover:text-white rounded-lg hover:bg-dark-700 transition-colors\"\n        @click=\"handleReset\"\n      >\n        Reset\n      </button>\n\n      <button\n        type=\"button\"\n        class=\"px-4 py-2 text-sm text-dark-300 bg-dark-700 hover:bg-dark-600 rounded-lg transition-colors\"\n        @click=\"handleCancel\"\n      >\n        {{ cancelLabel }}\n      </button>\n\n      <button\n        type=\"button\"\n        class=\"px-6 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-500 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n        :disabled=\"!state.image || loading\"\n        @click=\"handleConfirm\"\n      >\n        {{ confirmLabel }}\n      </button>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.avatar-cropper {\n  --color-primary-500: #8b5cf6;\n  --color-primary-600: #7c3aed;\n  --color-dark-400: #9ca3af;\n  --color-dark-500: #6b7280;\n  --color-dark-600: #4b5563;\n  --color-dark-700: #374151;\n  --color-dark-800: #1f2937;\n  --color-dark-900: #111827;\n}\n\n.zoom-slider::-webkit-slider-thumb {\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  background: white;\n  border-radius: 50%;\n  cursor: pointer;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n  transition: transform 0.15s ease;\n}\n\n.zoom-slider::-webkit-slider-thumb:hover {\n  transform: scale(1.1);\n}\n\n.zoom-slider::-webkit-slider-thumb:active {\n  transform: scale(0.95);\n}\n\n.zoom-slider::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  background: white;\n  border-radius: 50%;\n  cursor: pointer;\n  border: none;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n}\n</style>\n\n","<script setup lang=\"ts\">\nimport { ref, computed, watch, onUnmounted } from 'vue'\nimport { useAvatarUpload, type AvatarUploadConfig, type AvatarUploadResult } from '../composables/useAvatarUpload'\nimport type { AvatarCrop } from '../composables/useAvatarManager'\nimport AvatarCropper from './AvatarCropper.vue'\n\nexport interface AvatarUploadProps {\n  /** Current avatar URL to display */\n  modelValue?: string | null\n  /** Size of the avatar in pixels (default: 120) */\n  size?: number\n  /** Upload configuration */\n  config?: Partial<AvatarUploadConfig>\n  /** Whether the avatar is editable (default: true) */\n  editable?: boolean\n  /** Placeholder text when no avatar (default: initials or icon) */\n  placeholder?: string\n  /** Shape: 'circle' | 'rounded' | 'square' */\n  shape?: 'circle' | 'rounded' | 'square'\n  /** Show upload progress ring */\n  showProgress?: boolean\n  /** Custom CSS classes for the container */\n  containerClass?: string\n  /** Enable crop UI before upload (default: false) */\n  enableCrop?: boolean\n  /** Crop area size in pixels (default: 280) */\n  cropSize?: number\n  /** Output size for cropped image (default: 512) */\n  cropOutputSize?: number\n}\n\nconst props = withDefaults(defineProps<AvatarUploadProps>(), {\n  size: 120,\n  editable: true,\n  shape: 'circle',\n  showProgress: true,\n  enableCrop: false,\n  cropSize: 280,\n  cropOutputSize: 512,\n})\n\nconst emit = defineEmits<{\n  (e: 'update:modelValue', value: string): void\n  (e: 'upload-start', file: File): void\n  (e: 'upload-progress', progress: number): void\n  (e: 'upload-success', result: AvatarUploadResult & { crop?: AvatarCrop }): void\n  (e: 'upload-error', error: { message: string; code?: string }): void\n  (e: 'file-selected', file: File): void\n  (e: 'crop-applied', data: { file: File; crop: AvatarCrop }): void\n}>()\n\nconst {\n  uploading,\n  progress,\n  error,\n  previewUrl,\n  selectedFile,\n  selectFile,\n  clearSelection,\n  upload,\n  uploadWithCrop,\n} = useAvatarUpload(props.config)\n\nconst fileInput = ref<HTMLInputElement | null>(null)\nconst isDragging = ref(false)\nconst showCropper = ref(false)\nconst pendingFile = ref<File | null>(null)\nconst lastCrop = ref<AvatarCrop | null>(null)\n\n// Computed display URL (preview takes priority over modelValue)\nconst displayUrl = computed(() => previewUrl.value || props.modelValue || null)\n\n// Shape class\nconst shapeClass = computed(() => {\n  switch (props.shape) {\n    case 'rounded': return 'rounded-2xl'\n    case 'square': return 'rounded-none'\n    default: return 'rounded-full'\n  }\n})\n\n// Progress ring calculations\nconst circumference = computed(() => 2 * Math.PI * 45) // radius 45\nconst strokeDashoffset = computed(() => {\n  return circumference.value - (progress.value / 100) * circumference.value\n})\n\n// Watch for upload completion\nwatch(progress, (newProgress) => {\n  emit('upload-progress', newProgress)\n})\n\nwatch(error, (newError) => {\n  if (newError) {\n    emit('upload-error', newError)\n  }\n})\n\nfunction triggerFileInput() {\n  if (!props.editable || uploading.value) return\n  fileInput.value?.click()\n}\n\nfunction handleFileSelect(event: Event) {\n  const input = event.target as HTMLInputElement\n  const file = input.files?.[0]\n  if (file) {\n    handleFile(file)\n  }\n  // Reset input so same file can be selected again\n  input.value = ''\n}\n\nfunction handleFile(file: File) {\n  // Validate file type first\n  const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/heic', 'image/heif']\n  if (!validTypes.some(type => file.type === type)) {\n    emit('upload-error', { \n      message: 'Invalid file type. Please select a JPEG, PNG, WebP, or HEIC image.',\n      code: 'INVALID_TYPE'\n    })\n    return\n  }\n  \n  emit('file-selected', file)\n  \n  if (props.enableCrop) {\n    // Show cropper instead of auto-uploading\n    pendingFile.value = file\n    showCropper.value = true\n  } else {\n    // Original behavior: select and auto-upload\n    const validationError = selectFile(file)\n    if (validationError) {\n      return\n    }\n    handleUpload()\n  }\n}\n\nasync function handleUpload() {\n  if (!selectedFile.value) return\n  \n  emit('upload-start', selectedFile.value)\n  \n  const result = await upload()\n  \n  if (result) {\n    emit('upload-success', result)\n    // Emit the best available URL\n    const bestUrl = result.variants?.lg?.url || result.variants?.md?.url || result.url\n    emit('update:modelValue', bestUrl)\n    // Clear selection after successful upload\n    clearSelection()\n  }\n}\n\nasync function handleCropConfirm(data: { file: File; crop: AvatarCrop }) {\n  showCropper.value = false\n  pendingFile.value = null\n  lastCrop.value = data.crop\n  \n  emit('crop-applied', data)\n  \n  // Select the cropped file and upload\n  const validationError = selectFile(data.file)\n  if (validationError) {\n    return\n  }\n  \n  emit('upload-start', data.file)\n  \n  // Upload with crop metadata\n  const result = await uploadWithCrop(data.crop)\n  \n  if (result) {\n    emit('upload-success', { ...result, crop: data.crop })\n    const bestUrl = result.variants?.lg?.url || result.variants?.md?.url || result.url\n    emit('update:modelValue', bestUrl)\n    clearSelection()\n  }\n}\n\nfunction handleCropCancel() {\n  showCropper.value = false\n  pendingFile.value = null\n}\n\n// Drag and drop handlers\nfunction handleDragEnter(e: DragEvent) {\n  e.preventDefault()\n  if (props.editable && !uploading.value) {\n    isDragging.value = true\n  }\n}\n\nfunction handleDragLeave(e: DragEvent) {\n  e.preventDefault()\n  isDragging.value = false\n}\n\nfunction handleDragOver(e: DragEvent) {\n  e.preventDefault()\n}\n\nfunction handleDrop(e: DragEvent) {\n  e.preventDefault()\n  isDragging.value = false\n  \n  if (!props.editable || uploading.value) return\n  \n  const file = e.dataTransfer?.files[0]\n  if (file && file.type.startsWith('image/')) {\n    handleFile(file)\n  }\n}\n\n// Cleanup on unmount\nonUnmounted(() => {\n  clearSelection()\n})\n</script>\n\n<template>\n  <div>\n    <!-- Cropper Modal -->\n    <Teleport to=\"body\">\n      <Transition name=\"fade\">\n        <div\n          v-if=\"showCropper && pendingFile\"\n          class=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n        >\n          <!-- Backdrop -->\n          <div \n            class=\"absolute inset-0 bg-black/80 backdrop-blur-sm\"\n            @click=\"handleCropCancel\"\n          ></div>\n          \n          <!-- Cropper container -->\n          <div class=\"relative bg-dark-900 rounded-2xl p-6 shadow-2xl border border-dark-700 max-w-md w-full\">\n            <h3 class=\"text-lg font-semibold text-white mb-4 text-center\">\n              Adjust your photo\n            </h3>\n            \n            <AvatarCropper\n              :file=\"pendingFile\"\n              :shape=\"shape\"\n              :crop-size=\"cropSize\"\n              :output-size=\"cropOutputSize\"\n              confirm-label=\"Save\"\n              @confirm=\"handleCropConfirm\"\n              @cancel=\"handleCropCancel\"\n            />\n          </div>\n        </div>\n      </Transition>\n    </Teleport>\n\n    <!-- Main avatar display -->\n    <div \n      class=\"avatar-upload-container relative inline-block\"\n      :class=\"containerClass\"\n      :style=\"{ width: `${size}px`, height: `${size}px` }\"\n    >\n      <!-- Hidden file input -->\n      <input\n        ref=\"fileInput\"\n        type=\"file\"\n        accept=\"image/jpeg,image/png,image/webp,image/heic,image/heif\"\n        class=\"hidden\"\n        @change=\"handleFileSelect\"\n      />\n      \n      <!-- Avatar display -->\n      <div\n        class=\"avatar-upload relative w-full h-full overflow-hidden transition-all duration-200\"\n        :class=\"[\n          shapeClass,\n          editable && !uploading ? 'cursor-pointer hover:ring-4 hover:ring-primary-500/30' : '',\n          isDragging ? 'ring-4 ring-primary-500 scale-105' : '',\n          error ? 'ring-2 ring-red-500' : ''\n        ]\"\n        @click=\"triggerFileInput\"\n        @dragenter=\"handleDragEnter\"\n        @dragleave=\"handleDragLeave\"\n        @dragover=\"handleDragOver\"\n        @drop=\"handleDrop\"\n      >\n        <!-- Image -->\n        <img\n          v-if=\"displayUrl\"\n          :src=\"displayUrl\"\n          alt=\"Avatar\"\n          class=\"w-full h-full object-cover\"\n        />\n        \n        <!-- Placeholder when no image -->\n        <div\n          v-else\n          class=\"w-full h-full bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center\"\n        >\n          <span v-if=\"placeholder\" class=\"text-white font-semibold\" :style=\"{ fontSize: `${size / 3}px` }\">\n            {{ placeholder }}\n          </span>\n          <svg v-else class=\"text-slate-400\" :width=\"size / 2.5\" :height=\"size / 2.5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/>\n          </svg>\n        </div>\n        \n        <!-- Hover overlay for editable -->\n        <div\n          v-if=\"editable && !uploading\"\n          class=\"absolute inset-0 bg-black/50 opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center\"\n        >\n          <svg class=\"text-white\" width=\"24\" height=\"24\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" />\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" />\n          </svg>\n        </div>\n        \n        <!-- Upload progress overlay -->\n        <div\n          v-if=\"uploading\"\n          class=\"absolute inset-0 bg-black/60 flex items-center justify-center\"\n        >\n          <svg v-if=\"showProgress\" class=\"transform -rotate-90\" width=\"60\" height=\"60\" viewBox=\"0 0 100 100\">\n            <!-- Background circle -->\n            <circle\n              cx=\"50\"\n              cy=\"50\"\n              r=\"45\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              stroke-width=\"6\"\n              class=\"text-white/20\"\n            />\n            <!-- Progress circle -->\n            <circle\n              cx=\"50\"\n              cy=\"50\"\n              r=\"45\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              stroke-width=\"6\"\n              stroke-linecap=\"round\"\n              class=\"text-primary-500 transition-all duration-200\"\n              :stroke-dasharray=\"circumference\"\n              :stroke-dashoffset=\"strokeDashoffset\"\n            />\n          </svg>\n          <span class=\"absolute text-white font-medium text-sm\">{{ progress }}%</span>\n        </div>\n      </div>\n      \n      <!-- Error message -->\n      <div\n        v-if=\"error && !uploading\"\n        class=\"absolute -bottom-6 left-1/2 transform -translate-x-1/2 whitespace-nowrap text-xs text-red-400\"\n      >\n        {{ error.message }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.avatar-upload-container {\n  --color-primary-500: #8b5cf6;\n}\n\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.2s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n</style>\n\n","import { ref, computed, type Ref } from 'vue'\n\nexport interface AvatarVariant {\n  url: string\n  w: number\n  h: number\n}\n\nexport interface AvatarVariants {\n  /** ~1000px WebP for cropping/editing (browser-compatible) */\n  source?: AvatarVariant\n  sm?: AvatarVariant\n  md?: AvatarVariant\n  lg?: AvatarVariant\n}\n\nexport interface AvatarCrop {\n  x: number\n  y: number\n  width: number\n  height: number\n  zoom?: number\n}\n\nexport interface AvatarFallback {\n  type: 'initials' | 'default' | 'gravatar' | 'none'\n  initials?: string\n  background_color?: string\n  url?: string\n}\n\nexport interface Avatar {\n  id: string\n  name?: string\n  is_primary: boolean\n  source: 'upload' | 'gravatar' | 'oauth' | 'generated' | 'ai'\n  original_url: string\n  variants: AvatarVariants\n  format: 'static' | 'animated'\n  animated_url?: string\n  crop?: AvatarCrop\n  blurhash?: string\n  dominant_color?: string\n  alt_text?: string\n  moderation_status: 'pending' | 'approved' | 'rejected'\n  fallback: AvatarFallback\n  created_at: string\n  updated_at: string\n}\n\nexport interface AvatarManagerConfig {\n  /** Base API URL (e.g., '/api' or 'https://api.example.com') */\n  apiBaseUrl: string\n  /** Function to get auth headers */\n  getHeaders: () => Record<string, string>\n  /** Upload endpoint for new avatars */\n  uploadUrl?: string\n  /** Media proxy URL for loading external images (to bypass CORS) */\n  mediaProxyUrl?: string\n  /** Project ID for project-managed avatars */\n  projectId?: string\n  /** Entity type for project-managed avatars */\n  entityType?: string\n  /** Entity ID for project-managed avatars */\n  entityId?: string\n}\n\n// Global configuration\nconst globalConfig = ref<Partial<AvatarManagerConfig>>({})\n\n/**\n * Configure avatar manager globally\n */\nexport function configureAvatarManager(config: Partial<AvatarManagerConfig>) {\n  globalConfig.value = { ...globalConfig.value, ...config }\n}\n\n/**\n * Composable for managing multiple avatars\n */\nexport function useAvatarManager(localConfig?: Partial<AvatarManagerConfig>) {\n  const avatars = ref<Avatar[]>([])\n  const loading = ref(false)\n  const error = ref<string | null>(null)\n  const uploading = ref(false)\n  const uploadProgress = ref(0)\n\n  const config = computed<AvatarManagerConfig>(() => ({\n    apiBaseUrl: '/api',\n    getHeaders: () => ({}),\n    ...globalConfig.value,\n    ...localConfig,\n  }))\n\n  const primaryAvatar = computed(() => avatars.value.find(a => a.is_primary))\n\n  /**\n   * Fetch all avatars\n   */\n  async function fetchAvatars(): Promise<void> {\n    loading.value = true\n    error.value = null\n\n    try {\n      let url = `${config.value.apiBaseUrl}/avatars`\n      const params = new URLSearchParams()\n      \n      if (config.value.projectId) {\n        params.set('project_id', config.value.projectId)\n      }\n      if (config.value.entityType) {\n        params.set('entity_type', config.value.entityType)\n      }\n      if (config.value.entityId) {\n        params.set('entity_id', config.value.entityId)\n      }\n      \n      if (params.toString()) {\n        url += `?${params.toString()}`\n      }\n\n      const response = await fetch(url, {\n        headers: config.value.getHeaders(),\n      })\n\n      if (!response.ok) {\n        throw new Error(await response.text())\n      }\n\n      const data = await response.json()\n      avatars.value = data.avatars || []\n    } catch (e: any) {\n      error.value = e.message || 'Failed to fetch avatars'\n    } finally {\n      loading.value = false\n    }\n  }\n\n  /**\n   * Create a new avatar from an uploaded file result\n   */\n  async function createAvatar(data: {\n    original_url: string\n    file_id?: string\n    name?: string\n    is_primary?: boolean\n    variants?: AvatarVariants\n    blurhash?: string\n    dominant_color?: string\n    alt_text?: string\n    fallback_initials?: string\n  }): Promise<Avatar | null> {\n    error.value = null\n\n    try {\n      const response = await fetch(`${config.value.apiBaseUrl}/avatars`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...config.value.getHeaders(),\n        },\n        body: JSON.stringify({\n          original_url: data.original_url,\n          file_id: data.file_id,\n          name: data.name,\n          is_primary: data.is_primary ?? false,\n          source: 'upload',\n          format: 'static',\n          variants: data.variants,\n          blurhash: data.blurhash,\n          dominant_color: data.dominant_color,\n          alt_text: data.alt_text,\n          fallback_type: data.fallback_initials ? 'initials' : 'default',\n          fallback_data: data.fallback_initials ? { initials: data.fallback_initials } : undefined,\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error(await response.text())\n      }\n\n      const avatar = await response.json()\n      \n      // Refresh list\n      await fetchAvatars()\n      \n      return avatar\n    } catch (e: any) {\n      error.value = e.message || 'Failed to create avatar'\n      return null\n    }\n  }\n\n  /**\n   * Set an avatar as primary\n   */\n  async function setPrimary(avatarId: string): Promise<boolean> {\n    error.value = null\n\n    try {\n      const response = await fetch(`${config.value.apiBaseUrl}/avatars/${avatarId}/primary`, {\n        method: 'POST',\n        headers: config.value.getHeaders(),\n      })\n\n      if (!response.ok) {\n        throw new Error(await response.text())\n      }\n\n      // Update local state\n      avatars.value = avatars.value.map(a => ({\n        ...a,\n        is_primary: a.id === avatarId,\n      }))\n\n      return true\n    } catch (e: any) {\n      error.value = e.message || 'Failed to set primary avatar'\n      return false\n    }\n  }\n\n  /**\n   * Delete an avatar\n   */\n  async function deleteAvatar(avatarId: string): Promise<boolean> {\n    error.value = null\n\n    try {\n      const response = await fetch(`${config.value.apiBaseUrl}/avatars/${avatarId}`, {\n        method: 'DELETE',\n        headers: config.value.getHeaders(),\n      })\n\n      if (!response.ok) {\n        throw new Error(await response.text())\n      }\n\n      // Remove from local state\n      avatars.value = avatars.value.filter(a => a.id !== avatarId)\n\n      return true\n    } catch (e: any) {\n      error.value = e.message || 'Failed to delete avatar'\n      return false\n    }\n  }\n\n  /**\n   * Update an avatar\n   */\n  async function updateAvatar(avatarId: string, data: {\n    name?: string\n    crop?: AvatarCrop\n    alt_text?: string\n  }): Promise<Avatar | null> {\n    error.value = null\n\n    try {\n      const response = await fetch(`${config.value.apiBaseUrl}/avatars/${avatarId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          ...config.value.getHeaders(),\n        },\n        body: JSON.stringify(data),\n      })\n\n      if (!response.ok) {\n        throw new Error(await response.text())\n      }\n\n      const updatedAvatar = await response.json()\n\n      // Update local state\n      avatars.value = avatars.value.map(a => \n        a.id === avatarId ? updatedAvatar : a\n      )\n\n      return updatedAvatar\n    } catch (e: any) {\n      error.value = e.message || 'Failed to update avatar'\n      return null\n    }\n  }\n\n  /**\n   * Upload a file and create an avatar\n   */\n  async function uploadAndCreateAvatar(\n    file: File,\n    options?: {\n      name?: string\n      is_primary?: boolean\n      fallback_initials?: string\n      crop?: AvatarCrop\n    }\n  ): Promise<Avatar | null> {\n    if (!config.value.uploadUrl) {\n      error.value = 'Upload URL not configured'\n      return null\n    }\n\n    uploading.value = true\n    uploadProgress.value = 0\n    error.value = null\n\n    try {\n      const formData = new FormData()\n      formData.append('file', file)\n      formData.append('profile', 'avatar')\n\n      // Upload the file\n      const uploadResult = await new Promise<any>((resolve, reject) => {\n        const xhr = new XMLHttpRequest()\n\n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            uploadProgress.value = Math.round((e.loaded / e.total) * 100)\n          }\n        })\n\n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const response = JSON.parse(xhr.responseText)\n              resolve(response.data || response)\n            } catch {\n              reject(new Error('Invalid response from server'))\n            }\n          } else {\n            let errorMessage = 'Upload failed'\n            try {\n              const response = JSON.parse(xhr.responseText)\n              errorMessage = response.error || response.message || errorMessage\n            } catch {}\n            reject(new Error(errorMessage))\n          }\n        })\n\n        xhr.addEventListener('error', () => reject(new Error('Network error')))\n        xhr.addEventListener('abort', () => reject(new Error('Upload cancelled')))\n\n        xhr.open('POST', config.value.uploadUrl!)\n        \n        const headers = config.value.getHeaders()\n        for (const [key, value] of Object.entries(headers)) {\n          xhr.setRequestHeader(key, value)\n        }\n\n        xhr.send(formData)\n      })\n\n      uploadProgress.value = 100\n\n      // Create the avatar record\n      const avatar = await createAvatar({\n        original_url: uploadResult.url || uploadResult.signed_url,\n        file_id: uploadResult.id,\n        name: options?.name,\n        is_primary: options?.is_primary,\n        variants: uploadResult.variants,\n        fallback_initials: options?.fallback_initials,\n      })\n\n      return avatar\n    } catch (e: any) {\n      error.value = e.message || 'Failed to upload avatar'\n      return null\n    } finally {\n      uploading.value = false\n    }\n  }\n\n  /**\n   * Get the best URL for an avatar at a given size\n   * @param size - 'sm' | 'md' | 'lg' for display, 'source' for cropping/editing, 'original' for raw file\n   */\n  function getAvatarUrl(avatar: Avatar, size: 'sm' | 'md' | 'lg' | 'source' | 'original' = 'md'): string {\n    if (size === 'original') {\n      return avatar.original_url\n    }\n    \n    if (size === 'source') {\n      // For cropping: prefer source, then original\n      return avatar.variants.source?.url || avatar.original_url\n    }\n    \n    const variant = avatar.variants[size]\n    if (variant) {\n      return variant.url\n    }\n\n    // Fallback to other sizes\n    if (size === 'sm') {\n      return avatar.variants.md?.url || avatar.variants.lg?.url || avatar.original_url\n    }\n    if (size === 'md') {\n      return avatar.variants.lg?.url || avatar.variants.sm?.url || avatar.original_url\n    }\n    if (size === 'lg') {\n      return avatar.variants.md?.url || avatar.variants.sm?.url || avatar.original_url\n    }\n\n    return avatar.original_url\n  }\n\n  return {\n    // State\n    avatars,\n    loading,\n    error,\n    uploading,\n    uploadProgress,\n    primaryAvatar,\n    config,\n\n    // Methods\n    fetchAvatars,\n    createAvatar,\n    setPrimary,\n    deleteAvatar,\n    updateAvatar,\n    uploadAndCreateAvatar,\n    getAvatarUrl,\n  }\n}\n\n","<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue'\nimport { useAvatarManager, type Avatar, type AvatarManagerConfig, type AvatarCrop } from '../composables/useAvatarManager'\nimport AvatarCropper from './AvatarCropper.vue'\n\nconst props = withDefaults(defineProps<{\n  /** Current user's initials for fallback */\n  initials?: string\n  /** Maximum number of avatars allowed */\n  maxAvatars?: number\n  /** Show upload button */\n  allowUpload?: boolean\n  /** Show delete buttons */\n  allowDelete?: boolean\n  /** Allow editing/cropping avatars */\n  allowEdit?: boolean\n  /** Enable crop UI when uploading */\n  enableCropOnUpload?: boolean\n  /** Avatar grid size (compact mode) */\n  avatarSize?: number\n  /** Shape of avatars */\n  shape?: 'circle' | 'square' | 'rounded'\n  /** Display mode: 'compact' (grid) or 'expanded' (list with details) */\n  mode?: 'compact' | 'expanded'\n  /** Crop preview size */\n  cropSize?: number\n  /** Local config overrides */\n  config?: Partial<AvatarManagerConfig>\n}>(), {\n  initials: '',\n  maxAvatars: 10,\n  allowUpload: true,\n  allowDelete: true,\n  allowEdit: true,\n  enableCropOnUpload: true,\n  avatarSize: 80,\n  shape: 'circle',\n  mode: 'compact',\n  cropSize: 280,\n})\n\nconst emit = defineEmits<{\n  (e: 'select', avatar: Avatar): void\n  (e: 'primary-changed', avatar: Avatar): void\n  (e: 'upload-success', avatar: Avatar): void\n  (e: 'upload-error', error: string): void\n  (e: 'delete', avatar: Avatar): void\n  (e: 'crop-updated', avatar: Avatar, crop: AvatarCrop): void\n}>()\n\nconst {\n  avatars,\n  loading,\n  error,\n  uploading,\n  uploadProgress,\n  config,\n  fetchAvatars,\n  setPrimary,\n  deleteAvatar,\n  uploadAndCreateAvatar,\n  getAvatarUrl,\n} = useAvatarManager(props.config)\n\nconst fileInputRef = ref<HTMLInputElement | null>(null)\nconst confirmDeleteId = ref<string | null>(null)\nconst selectedId = ref<string | null>(null)\n\n// Cropper state\nconst showCropper = ref(false)\nconst cropperMode = ref<'upload' | 'edit'>('upload')\nconst pendingUploadFile = ref<File | null>(null)\nconst editingAvatar = ref<Avatar | null>(null)\n\nconst canUpload = computed(() => {\n  return props.allowUpload && avatars.value.length < props.maxAvatars\n})\n\nconst shapeClass = computed(() => {\n  switch (props.shape) {\n    case 'circle': return 'rounded-full'\n    case 'square': return 'rounded-none'\n    case 'rounded': return 'rounded-xl'\n    default: return 'rounded-full'\n  }\n})\n\n// For the cropper, get the image URL to edit\nconst cropperUrl = computed(() => {\n  if (editingAvatar.value) {\n    return editingAvatar.value.original_url\n  }\n  return null\n})\n\nonMounted(() => {\n  fetchAvatars()\n})\n\nfunction triggerUpload() {\n  fileInputRef.value?.click()\n}\n\nasync function handleFileSelect(event: Event) {\n  const input = event.target as HTMLInputElement\n  const file = input.files?.[0]\n  if (!file) return\n\n  input.value = ''\n\n  if (props.enableCropOnUpload) {\n    // Show cropper before uploading\n    pendingUploadFile.value = file\n    cropperMode.value = 'upload'\n    showCropper.value = true\n  } else {\n    // Direct upload without cropping\n    const avatar = await uploadAndCreateAvatar(file, {\n      name: `Avatar ${avatars.value.length + 1}`,\n      is_primary: avatars.value.length === 0,\n      fallback_initials: props.initials,\n    })\n\n    if (avatar) {\n      emit('upload-success', avatar)\n    } else if (error.value) {\n      emit('upload-error', error.value)\n    }\n  }\n}\n\nfunction handleEditAvatar(avatar: Avatar) {\n  editingAvatar.value = avatar\n  cropperMode.value = 'edit'\n  showCropper.value = true\n}\n\nasync function handleCropConfirm(data: { file: File; crop: AvatarCrop }) {\n  showCropper.value = false\n\n  if (cropperMode.value === 'upload' && pendingUploadFile.value) {\n    // Upload the cropped file\n    const avatar = await uploadAndCreateAvatar(data.file, {\n      name: `Avatar ${avatars.value.length + 1}`,\n      is_primary: avatars.value.length === 0,\n      fallback_initials: props.initials,\n      crop: data.crop,\n    })\n\n    if (avatar) {\n      emit('upload-success', avatar)\n    } else if (error.value) {\n      emit('upload-error', error.value)\n    }\n  } else if (cropperMode.value === 'edit' && editingAvatar.value) {\n    // Re-upload the cropped version and update the avatar\n    const avatar = await uploadAndCreateAvatar(data.file, {\n      name: editingAvatar.value.name,\n      is_primary: editingAvatar.value.is_primary,\n      fallback_initials: props.initials,\n      crop: data.crop,\n    })\n\n    if (avatar) {\n      // Delete the old avatar if the new one was created successfully\n      await deleteAvatar(editingAvatar.value.id)\n      emit('crop-updated', avatar, data.crop)\n    } else if (error.value) {\n      emit('upload-error', error.value)\n    }\n  }\n\n  // Reset state\n  pendingUploadFile.value = null\n  editingAvatar.value = null\n}\n\nfunction handleCropCancel() {\n  showCropper.value = false\n  pendingUploadFile.value = null\n  editingAvatar.value = null\n}\n\nasync function handleSetPrimary(avatar: Avatar) {\n  if (avatar.is_primary) return\n  const success = await setPrimary(avatar.id)\n  if (success) {\n    emit('primary-changed', avatar)\n  }\n}\n\nasync function handleDelete(avatar: Avatar) {\n  if (confirmDeleteId.value !== avatar.id) {\n    confirmDeleteId.value = avatar.id\n    return\n  }\n\n  const success = await deleteAvatar(avatar.id)\n  if (success) {\n    emit('delete', avatar)\n    confirmDeleteId.value = null\n  }\n}\n\nfunction cancelDelete() {\n  confirmDeleteId.value = null\n}\n\nfunction selectAvatar(avatar: Avatar) {\n  selectedId.value = avatar.id\n  emit('select', avatar)\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr)\n  return date.toLocaleDateString(undefined, { \n    month: 'short', \n    day: 'numeric',\n    year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined\n  })\n}\n\nfunction getSourceLabel(source: string): string {\n  const labels: Record<string, string> = {\n    upload: 'Uploaded',\n    gravatar: 'Gravatar',\n    oauth: 'OAuth',\n    generated: 'Generated',\n    ai: 'AI Generated',\n  }\n  return labels[source] || source\n}\n</script>\n\n<template>\n  <div class=\"avatar-manager\">\n    <!-- Hidden file input -->\n    <input\n      ref=\"fileInputRef\"\n      type=\"file\"\n      accept=\"image/*\"\n      class=\"hidden\"\n      @change=\"handleFileSelect\"\n    />\n\n    <!-- Cropper Modal -->\n    <Teleport to=\"body\">\n      <Transition name=\"fade\">\n        <div\n          v-if=\"showCropper && (pendingUploadFile || editingAvatar)\"\n          class=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n        >\n          <!-- Backdrop -->\n          <div \n            class=\"absolute inset-0 bg-black/80 backdrop-blur-sm\"\n            @click=\"handleCropCancel\"\n          ></div>\n          \n          <!-- Cropper container -->\n          <div class=\"relative bg-dark-900 rounded-2xl p-6 shadow-2xl border border-dark-700 max-w-md w-full\">\n            <h3 class=\"text-lg font-semibold text-white mb-4 text-center\">\n              {{ cropperMode === 'edit' ? 'Adjust your photo' : 'Position your photo' }}\n            </h3>\n            \n            <AvatarCropper\n              :file=\"pendingUploadFile\"\n              :url=\"cropperUrl\"\n              :shape=\"shape\"\n              :crop-size=\"cropSize\"\n              :config=\"{ mediaProxyUrl: config.mediaProxyUrl }\"\n              :confirm-label=\"cropperMode === 'edit' ? 'Save changes' : 'Upload'\"\n              @confirm=\"handleCropConfirm\"\n              @cancel=\"handleCropCancel\"\n            />\n          </div>\n        </div>\n      </Transition>\n    </Teleport>\n\n    <!-- Loading state -->\n    <div v-if=\"loading && avatars.length === 0\" class=\"flex items-center justify-center py-8\">\n      <div class=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\"></div>\n    </div>\n\n    <!-- Error state -->\n    <div v-else-if=\"error && avatars.length === 0\" class=\"text-center py-8\">\n      <div class=\"text-red-400 mb-2\">{{ error }}</div>\n      <button \n        @click=\"fetchAvatars\"\n        class=\"text-sm text-primary-400 hover:text-primary-300 underline\"\n      >\n        Try again\n      </button>\n    </div>\n\n    <!-- ================================ -->\n    <!-- COMPACT MODE (Grid) -->\n    <!-- ================================ -->\n    <div v-else-if=\"mode === 'compact'\" class=\"space-y-3\">\n      <div class=\"flex flex-wrap gap-3\">\n        <!-- Existing avatars -->\n        <div\n          v-for=\"avatar in avatars\"\n          :key=\"avatar.id\"\n          class=\"relative group\"\n          :style=\"{ width: `${avatarSize}px`, height: `${avatarSize}px` }\"\n        >\n          <!-- Avatar with ring indicator for primary -->\n          <button\n            @click=\"selectAvatar(avatar)\"\n            class=\"w-full h-full overflow-hidden transition-all duration-200\"\n            :class=\"[\n              shapeClass,\n              avatar.is_primary \n                ? 'ring-[3px] ring-emerald-500 ring-offset-2 ring-offset-dark-900' \n                : selectedId === avatar.id \n                  ? 'ring-2 ring-dark-400 ring-offset-2 ring-offset-dark-900' \n                  : 'ring-2 ring-transparent hover:ring-dark-500 ring-offset-2 ring-offset-dark-900'\n            ]\"\n          >\n            <img\n              :src=\"getAvatarUrl(avatar, 'md')\"\n              :alt=\"avatar.alt_text || avatar.name || 'Avatar'\"\n              class=\"w-full h-full object-cover\"\n              :style=\"avatar.dominant_color ? { backgroundColor: avatar.dominant_color } : {}\"\n            />\n          </button>\n\n          <!-- Moderation pending badge (only badge we keep) -->\n          <div\n            v-if=\"avatar.moderation_status === 'pending'\"\n            class=\"absolute -top-1 -right-1 w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg\"\n            title=\"Pending moderation\"\n          >\n            <svg class=\"w-3 h-3 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clip-rule=\"evenodd\" />\n            </svg>\n          </div>\n\n          <!-- Hover actions overlay -->\n          <div\n            class=\"absolute inset-0 bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-1\"\n            :class=\"[\n              shapeClass,\n              confirmDeleteId === avatar.id ? 'z-50 opacity-100' : 'z-10'\n            ]\"\n          >\n            <!-- Edit/Crop button -->\n            <button\n              v-if=\"allowEdit\"\n              type=\"button\"\n              @click.stop=\"handleEditAvatar(avatar)\"\n              class=\"p-1.5 bg-dark-700 hover:bg-primary-600 rounded-lg transition-colors\"\n              title=\"Edit crop\"\n            >\n              <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n              </svg>\n            </button>\n\n            <button\n              v-if=\"!avatar.is_primary\"\n              type=\"button\"\n              @click.stop=\"handleSetPrimary(avatar)\"\n              class=\"p-1.5 bg-dark-700 hover:bg-emerald-600 rounded-lg transition-colors\"\n              title=\"Set as primary\"\n            >\n              <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </button>\n\n            <button\n              v-if=\"allowDelete\"\n              type=\"button\"\n              @click.stop=\"handleDelete(avatar)\"\n              class=\"p-1.5 rounded-lg transition-colors\"\n              :class=\"confirmDeleteId === avatar.id ? 'bg-red-600 hover:bg-red-700' : 'bg-dark-700 hover:bg-red-600'\"\n              :title=\"confirmDeleteId === avatar.id ? 'Click again to confirm' : 'Delete'\"\n            >\n              <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <!-- Upload button -->\n        <button\n          v-if=\"canUpload\"\n          type=\"button\"\n          @click=\"triggerUpload\"\n          :disabled=\"uploading\"\n          class=\"flex items-center justify-center border-2 border-dashed border-dark-600 hover:border-primary-500 transition-colors\"\n          :class=\"shapeClass\"\n          :style=\"{ width: `${avatarSize}px`, height: `${avatarSize}px` }\"\n        >\n          <div v-if=\"uploading\" class=\"relative w-full h-full flex items-center justify-center\">\n            <svg class=\"absolute inset-2 w-auto h-auto\" viewBox=\"0 0 36 36\">\n              <path\n                class=\"text-dark-700\"\n                stroke=\"currentColor\"\n                stroke-width=\"3\"\n                fill=\"none\"\n                d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"\n              />\n              <path\n                class=\"text-primary-500\"\n                stroke=\"currentColor\"\n                stroke-width=\"3\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n                :stroke-dasharray=\"`${uploadProgress}, 100`\"\n                d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"\n              />\n            </svg>\n            <span class=\"text-xs font-medium text-dark-300\">{{ uploadProgress }}%</span>\n          </div>\n          <div v-else class=\"text-dark-500 hover:text-primary-400 transition-colors\">\n            <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\" />\n            </svg>\n          </div>\n        </button>\n      </div>\n\n      <!-- Help text -->\n      <p class=\"text-xs text-dark-500\">\n        <span v-if=\"avatars.length === 0\">Upload your first avatar</span>\n        <span v-else>\n          {{ avatars.length }}/{{ maxAvatars }} · \n          <span class=\"text-emerald-500\">Green ring</span> = primary · Hover for options\n        </span>\n      </p>\n\n      <div v-if=\"error\" class=\"text-sm text-red-400\">{{ error }}</div>\n    </div>\n\n    <!-- ================================ -->\n    <!-- EXPANDED MODE (List with details) -->\n    <!-- ================================ -->\n    <div v-else class=\"space-y-3\">\n      <!-- Avatar list -->\n      <div class=\"space-y-2\">\n        <div\n          v-for=\"avatar in avatars\"\n          :key=\"avatar.id\"\n          class=\"flex items-center gap-4 p-3 rounded-xl transition-colors\"\n          :class=\"[\n            avatar.is_primary \n              ? 'bg-emerald-500/10 border border-emerald-500/30' \n              : 'bg-dark-800 border border-dark-700 hover:border-dark-600'\n          ]\"\n        >\n          <!-- Avatar thumbnail -->\n          <button\n            @click=\"selectAvatar(avatar)\"\n            class=\"flex-shrink-0 w-14 h-14 overflow-hidden transition-transform hover:scale-105\"\n            :class=\"shapeClass\"\n          >\n            <img\n              :src=\"getAvatarUrl(avatar, 'sm')\"\n              :alt=\"avatar.alt_text || avatar.name || 'Avatar'\"\n              class=\"w-full h-full object-cover\"\n            />\n          </button>\n\n          <!-- Avatar info -->\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"flex items-center gap-2\">\n              <span class=\"font-medium text-white truncate\">\n                {{ avatar.name || 'Unnamed avatar' }}\n              </span>\n              <span \n                v-if=\"avatar.is_primary\" \n                class=\"px-2 py-0.5 text-xs font-medium bg-emerald-500/20 text-emerald-400 rounded-full\"\n              >\n                Primary\n              </span>\n              <span \n                v-if=\"avatar.moderation_status === 'pending'\" \n                class=\"px-2 py-0.5 text-xs font-medium bg-yellow-500/20 text-yellow-400 rounded-full\"\n              >\n                Pending\n              </span>\n            </div>\n            <div class=\"flex items-center gap-3 mt-1 text-xs text-dark-400\">\n              <span>{{ getSourceLabel(avatar.source) }}</span>\n              <span>·</span>\n              <span>{{ formatDate(avatar.created_at) }}</span>\n              <span v-if=\"avatar.format === 'animated'\">·</span>\n              <span v-if=\"avatar.format === 'animated'\" class=\"text-purple-400\">Animated</span>\n            </div>\n          </div>\n\n          <!-- Actions -->\n          <div class=\"flex items-center gap-2\">\n            <!-- Edit/Crop button -->\n            <button\n              v-if=\"allowEdit\"\n              type=\"button\"\n              @click=\"handleEditAvatar(avatar)\"\n              class=\"p-2 text-dark-400 hover:text-primary-400 hover:bg-dark-700 rounded-lg transition-colors\"\n              title=\"Edit crop\"\n            >\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n              </svg>\n            </button>\n\n            <button\n              v-if=\"!avatar.is_primary\"\n              type=\"button\"\n              @click=\"handleSetPrimary(avatar)\"\n              class=\"p-2 text-dark-400 hover:text-emerald-400 hover:bg-dark-700 rounded-lg transition-colors\"\n              title=\"Set as primary\"\n            >\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </button>\n\n            <button\n              v-if=\"allowDelete\"\n              type=\"button\"\n              @click=\"handleDelete(avatar)\"\n              class=\"p-2 rounded-lg transition-colors\"\n              :class=\"confirmDeleteId === avatar.id \n                ? 'text-white bg-red-600 hover:bg-red-700' \n                : 'text-dark-400 hover:text-red-400 hover:bg-dark-700'\"\n              :title=\"confirmDeleteId === avatar.id ? 'Click again to confirm' : 'Delete'\"\n            >\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <!-- Upload button (expanded) -->\n      <button\n        v-if=\"canUpload\"\n        type=\"button\"\n        @click=\"triggerUpload\"\n        :disabled=\"uploading\"\n        class=\"w-full flex items-center justify-center gap-3 p-4 border-2 border-dashed border-dark-600 hover:border-primary-500 rounded-xl transition-colors group\"\n      >\n        <template v-if=\"uploading\">\n          <div class=\"w-5 h-5 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\"></div>\n          <span class=\"text-dark-400\">Uploading... {{ uploadProgress }}%</span>\n        </template>\n        <template v-else>\n          <svg class=\"w-5 h-5 text-dark-500 group-hover:text-primary-400 transition-colors\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\" />\n          </svg>\n          <span class=\"text-dark-500 group-hover:text-primary-400 transition-colors\">\n            Add new avatar\n          </span>\n        </template>\n      </button>\n\n      <!-- Footer info -->\n      <div class=\"flex items-center justify-between text-xs text-dark-500\">\n        <span>{{ avatars.length }} of {{ maxAvatars }} avatars</span>\n        <span v-if=\"error\" class=\"text-red-400\">{{ error }}</span>\n      </div>\n    </div>\n\n    <!-- Confirm delete overlay (click outside to cancel) -->\n    <div\n      v-if=\"confirmDeleteId\"\n      class=\"fixed inset-0 z-40\"\n      @click=\"cancelDelete\"\n    ></div>\n  </div>\n</template>\n\n<style scoped>\n.avatar-manager {\n  @apply relative;\n}\n\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.2s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n</style>\n"],"names":["isOpen","ref","images","initialIndex","variantFetcher","useImageViewer","setVariantFetcher","fn","getVariantFetcher","openViewer","newImages","startIndex","closeViewer","openImage","url","alt","readonly","value","MIN_ZOOM","MAX_ZOOM","ZOOM_STEP","props","__props","emit","__emit","currentIndex","zoom","panX","panY","isDragging","dragStart","isLoading","hasError","isLoadingVariants","loadedVariants","currentImageRaw","computed","currentImage","raw","variants","currentImageUrl","img","_a","_b","_c","_d","_e","hasMultiple","canPrev","canNext","watch","fetchVariantsIfNeeded","fetcher","err","prev","next","goTo","index","zoomIn","zoomOut","resetZoom","handleWheel","startDrag","point","doDrag","endDrag","handleKeydown","downloadImage","downloadUrl","blob","a","onImageLoad","onImageError","handleBackdropClick","onMounted","onUnmounted","imageStyle","_createBlock","_Teleport","_createVNode","_Transition","_createElementBlock","_createElementVNode","_hoisted_1","_hoisted_2","_toDisplayString","_hoisted_3","_openBlock","_hoisted_4","_cache","_hoisted_5","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_Fragment","_renderList","idx","_normalizeClass","$event","_setOpen","imagesList","handleClose","ImageViewer","_unref","globalConfig","configureAvatarUpload","config","useAvatarUpload","localConfig","uploading","progress","error","previewUrl","selectedFile","validateFile","file","type","selectFile","validationError","clearSelection","upload","formData","headers","result","resolve","reject","xhr","e","response","data","errorMessage","key","selectAndUpload","uploadWithCrop","crop","defaultConfig","useAvatarCropper","mergedConfig","state","loading","sourceFile","sourceUrl","initializeImageState","cropSize","scaleX","scaleY","minZoom","centerImage","loadFile","loadImage","loadUrl","mediaProxyUrl","isExternalUrl","src","naturalWidth","naturalHeight","visibleWidth","visibleHeight","setZoom","newZoom","maxZoom","clampedZoom","oldZoom","centerX","centerY","clampPan","pan","deltaX","deltaY","maxPanX","maxPanY","cropRegion","width","height","imageTransform","translateX","translateY","exportCrop","outputSize","format","quality","canvas","ctx","exportCropAsFile","filename","ext","name","cleanup","reset","cropperConfig","cropAreaRef","lastPointer","newFile","newUrl","zoomPercent","normalizedZoom","shapeClass","handlePointerDown","handlePointerMove","handlePointerUp","delta","range","lastTouchDistance","handleTouchStart","getTouchDistance","handleTouchMove","newDistance","scale","touches","dx","dy","handleConfirm","handleCancel","handleReset","handleKeyDown","_normalizeStyle","_hoisted_6","_hoisted_12","_hoisted_13","_hoisted_14","fileInput","showCropper","pendingFile","lastCrop","displayUrl","circumference","strokeDashoffset","newProgress","newError","triggerFileInput","handleFileSelect","event","input","handleFile","handleUpload","bestUrl","handleCropConfirm","handleCropCancel","handleDragEnter","handleDragLeave","handleDragOver","handleDrop","AvatarCropper","_hoisted_11","configureAvatarManager","useAvatarManager","avatars","uploadProgress","primaryAvatar","fetchAvatars","params","createAvatar","avatar","setPrimary","avatarId","deleteAvatar","updateAvatar","updatedAvatar","uploadAndCreateAvatar","options","uploadResult","getAvatarUrl","size","variant","_f","_g","fileInputRef","confirmDeleteId","selectedId","cropperMode","pendingUploadFile","editingAvatar","canUpload","cropperUrl","triggerUpload","handleEditAvatar","handleSetPrimary","handleDelete","cancelDelete","selectAvatar","formatDate","dateStr","date","getSourceLabel","source","args","_withModifiers","_hoisted_17","_hoisted_18","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_24","_createTextVNode","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_37","_hoisted_38","_hoisted_43","_hoisted_44","_hoisted_45"],"mappings":"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"}